!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("d3")):"function"==typeof define&&define.amd?define(["d3"],t):"object"==typeof exports?exports.fornac=t(require("d3")):e.fornac=t(e.d3)}(window,function(e){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=16)}([function(t,n){t.exports=e},function(e,t,n){e.exports={fornacPlot:"fornac-fornacPlot",node:"fornac-node",label:"fornac-label",outlineNode:"fornac-outlineNode",protein:"fornac-protein",hiddenOutline:"fornac-hiddenOutline",link:"fornac-link",rnaName:"fornac-rnaName",transparent:"fornac-transparent",dragLine:"fornac-dragLine",dragLineHidden:"fornac-dragLineHidden",nodeLabel:"fornac-nodeLabel",selected:"fornac-selected",brush:"fornac-brush",noselect:"fornac-noselect"}},function(e,t,n){e.exports=n(8)},function(e,t,n){"use strict";n.r(t),n.d(t,"Connection",function(){return i});var r=n(4),o=n(5);function i(){this.loop=new r.a,this.region=new o.a,this.start=null,this.end=null,this.xrad=null,this.yrad=null,this.angle=null,this.extruded=null,this.broken=null,this._isNull=!1}i.prototype.isNull=function(){return this._isNull},i.prototype.setNull=function(e){this._isNull=e},i.prototype.getLoop=function(){return this.loop},i.prototype.setLoop=function(e){this.loop=e},i.prototype.getRegion=function(){return this.region},i.prototype.setRegion=function(e){this.region=e},i.prototype.getStart=function(){return this.start},i.prototype.setStart=function(e){this.start=e},i.prototype.getEnd=function(){return this.end},i.prototype.setEnd=function(e){this.end=e},i.prototype.getXrad=function(){return this.xrad},i.prototype.setXrad=function(e){this.xrad=e},i.prototype.getYrad=function(){return this.yrad},i.prototype.setYrad=function(e){this.yrad=e},i.prototype.getAngle=function(){return this.angle},i.prototype.setAngle=function(e){this.angle=e},i.prototype.isExtruded=function(){return this.extruded},i.prototype.setExtruded=function(e){this.extruded=e},i.prototype.isBroken=function(){return this.broken},i.prototype.setBroken=function(e){this.broken=e}},function(e,t,n){"use strict";n.d(t,"a",function(){return o});var r=n(3);function o(){this.nconnection=null,this.connections=[],this._connections=[],this.number=null,this.depth=null,this.mark=null,this.x=null,this.y=null,this.radius=null}o.prototype.getNconnection=function(){return this.nconnection},o.prototype.setNconnection=function(e){this.nconnection=e},o.prototype.setConnection=function(e,t){null!=t?this._connections[e]=t:(this._connections[e]||(this._connections[e]=new r.Connection),this._connections[e].setNull(!0))},o.prototype.getConnection=function(e){var t=n(3);this._connections[e]||(this._connections[e]=new t);var r=this._connections[e];return r.isNull()?null:r},o.prototype.addConnection=function(e,t){this._connections.push(t)},o.prototype.getNumber=function(){return this.number},o.prototype.setNumber=function(e){this.number=e},o.prototype.getDepth=function(){return this.depth},o.prototype.setDepth=function(e){this.depth=e},o.prototype.isMark=function(){return this.mark},o.prototype.setMark=function(e){this.mark=e},o.prototype.getX=function(){return this.x},o.prototype.setX=function(e){this.x=e},o.prototype.getY=function(){return this.y},o.prototype.setY=function(e){this.y=e},o.prototype.getRadius=function(){return this.radius},o.prototype.setRadius=function(e){this.radius=e}},function(e,t,n){"use strict";function r(){this._start1=null,this._end1=null,this._start2=null,this._end2=null}n.d(t,"a",function(){return r}),r.prototype.getStart1=function(){return this._start1},r.prototype.setStart1=function(e){this._start1=e},r.prototype.getEnd1=function(){return this._end1},r.prototype.setEnd1=function(e){this._end1=e},r.prototype.getStart2=function(){return this._start2},r.prototype.setStart2=function(e){this._start2=e},r.prototype.getEnd2=function(){return this._end2},r.prototype.setEnd2=function(e){this._end2=e}},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){e.exports=n.p+"fa9b45d63b40299e0188927ca7d381a3.svg"},function(e,t,n){(function(e){var r=n(13);t.encode=function(t){var n=r.parse(t);return new e(n).toString("base64").replace(/\+/g,"-").replace(/\//g,"_").substring(0,22)},t.decode=function(t){var n=t.replace(/-/g,"+").replace(/_/g,"/")+"==";return r.unparse(new e(n,"base64"))},t.v4=function(){return r.v4(null,new e(16)).toString("base64").replace(/\+/g,"-").replace(/\//g,"_").substring(0,22)},t.nice=function(){var t=r.v4(null,new e(16));return t[0]=127&t[0],t.toString("base64").replace(/\+/g,"-").replace(/\//g,"_").substring(0,22)}}).call(this,n(9).Buffer)},function(e,t,n){"use strict";(function(e){
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * @license  MIT
 */
var r=n(10),o=n(11),i=n(12);function s(){return l.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function a(e,t){if(s()<t)throw new RangeError("Invalid typed array length");return l.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=l.prototype:(null===e&&(e=new l(t)),e.length=t),e}function l(e,t,n){if(!(l.TYPED_ARRAY_SUPPORT||this instanceof l))return new l(e,t,n);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return d(this,e)}return u(this,e,t,n)}function u(e,t,n,r){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,n,r){if(t.byteLength,n<0||t.byteLength<n)throw new RangeError("'offset' is out of bounds");if(t.byteLength<n+(r||0))throw new RangeError("'length' is out of bounds");t=void 0===n&&void 0===r?new Uint8Array(t):void 0===r?new Uint8Array(t,n):new Uint8Array(t,n,r);l.TYPED_ARRAY_SUPPORT?(e=t).__proto__=l.prototype:e=h(e,t);return e}(e,t,n,r):"string"==typeof t?function(e,t,n){"string"==typeof n&&""!==n||(n="utf8");if(!l.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var r=0|p(t,n),o=(e=a(e,r)).write(t,n);o!==r&&(e=e.slice(0,o));return e}(e,t,n):function(e,t){if(l.isBuffer(t)){var n=0|f(t.length);return 0===(e=a(e,n)).length?e:(t.copy(e,0,0,n),e)}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||(r=t.length)!=r?a(e,0):h(e,t);if("Buffer"===t.type&&i(t.data))return h(e,t.data)}var r;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function c(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function d(e,t){if(c(t),e=a(e,t<0?0:0|f(t)),!l.TYPED_ARRAY_SUPPORT)for(var n=0;n<t;++n)e[n]=0;return e}function h(e,t){var n=t.length<0?0:0|f(t.length);e=a(e,n);for(var r=0;r<n;r+=1)e[r]=255&t[r];return e}function f(e){if(e>=s())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+s().toString(16)+" bytes");return 0|e}function p(e,t){if(l.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var n=e.length;if(0===n)return 0;for(var r=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return D(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return q(e).length;default:if(r)return D(e).length;t=(""+t).toLowerCase(),r=!0}}function g(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function y(e,t,n,r,o){if(0===e.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=o?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(o)return-1;n=e.length-1}else if(n<0){if(!o)return-1;n=0}if("string"==typeof t&&(t=l.from(t,r)),l.isBuffer(t))return 0===t.length?-1:m(e,t,n,r,o);if("number"==typeof t)return t&=255,l.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?o?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):m(e,[t],n,r,o);throw new TypeError("val must be string, number or Buffer")}function m(e,t,n,r,o){var i,s=1,a=e.length,l=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1;s=2,a/=2,l/=2,n/=2}function u(e,t){return 1===s?e[t]:e.readUInt16BE(t*s)}if(o){var c=-1;for(i=n;i<a;i++)if(u(e,i)===u(t,-1===c?0:i-c)){if(-1===c&&(c=i),i-c+1===l)return c*s}else-1!==c&&(i-=i-c),c=-1}else for(n+l>a&&(n=a-l),i=n;i>=0;i--){for(var d=!0,h=0;h<l;h++)if(u(e,i+h)!==u(t,h)){d=!1;break}if(d)return i}return-1}function v(e,t,n,r){n=Number(n)||0;var o=e.length-n;r?(r=Number(r))>o&&(r=o):r=o;var i=t.length;if(i%2!=0)throw new TypeError("Invalid hex string");r>i/2&&(r=i/2);for(var s=0;s<r;++s){var a=parseInt(t.substr(2*s,2),16);if(isNaN(a))return s;e[n+s]=a}return s}function b(e,t,n,r){return F(D(t,e.length-n),e,n,r)}function k(e,t,n,r){return F(function(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,r)}function x(e,t,n,r){return k(e,t,n,r)}function w(e,t,n,r){return F(q(t),e,n,r)}function A(e,t,n,r){return F(function(e,t){for(var n,r,o,i=[],s=0;s<e.length&&!((t-=2)<0);++s)n=e.charCodeAt(s),r=n>>8,o=n%256,i.push(o),i.push(r);return i}(t,e.length-n),e,n,r)}function N(e,t,n){return 0===t&&n===e.length?r.fromByteArray(e):r.fromByteArray(e.slice(t,n))}function E(e,t,n){n=Math.min(e.length,n);for(var r=[],o=t;o<n;){var i,s,a,l,u=e[o],c=null,d=u>239?4:u>223?3:u>191?2:1;if(o+d<=n)switch(d){case 1:u<128&&(c=u);break;case 2:128==(192&(i=e[o+1]))&&(l=(31&u)<<6|63&i)>127&&(c=l);break;case 3:i=e[o+1],s=e[o+2],128==(192&i)&&128==(192&s)&&(l=(15&u)<<12|(63&i)<<6|63&s)>2047&&(l<55296||l>57343)&&(c=l);break;case 4:i=e[o+1],s=e[o+2],a=e[o+3],128==(192&i)&&128==(192&s)&&128==(192&a)&&(l=(15&u)<<18|(63&i)<<12|(63&s)<<6|63&a)>65535&&l<1114112&&(c=l)}null===c?(c=65533,d=1):c>65535&&(c-=65536,r.push(c>>>10&1023|55296),c=56320|1023&c),r.push(c),o+=d}return function(e){var t=e.length;if(t<=_)return String.fromCharCode.apply(String,e);var n="",r=0;for(;r<t;)n+=String.fromCharCode.apply(String,e.slice(r,r+=_));return n}(r)}t.Buffer=l,t.SlowBuffer=function(e){+e!=e&&(e=0);return l.alloc(+e)},t.INSPECT_MAX_BYTES=50,l.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(e){return!1}}(),t.kMaxLength=s(),l.poolSize=8192,l._augment=function(e){return e.__proto__=l.prototype,e},l.from=function(e,t,n){return u(null,e,t,n)},l.TYPED_ARRAY_SUPPORT&&(l.prototype.__proto__=Uint8Array.prototype,l.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&l[Symbol.species]===l&&Object.defineProperty(l,Symbol.species,{value:null,configurable:!0})),l.alloc=function(e,t,n){return function(e,t,n,r){return c(t),t<=0?a(e,t):void 0!==n?"string"==typeof r?a(e,t).fill(n,r):a(e,t).fill(n):a(e,t)}(null,e,t,n)},l.allocUnsafe=function(e){return d(null,e)},l.allocUnsafeSlow=function(e){return d(null,e)},l.isBuffer=function(e){return!(null==e||!e._isBuffer)},l.compare=function(e,t){if(!l.isBuffer(e)||!l.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var n=e.length,r=t.length,o=0,i=Math.min(n,r);o<i;++o)if(e[o]!==t[o]){n=e[o],r=t[o];break}return n<r?-1:r<n?1:0},l.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},l.concat=function(e,t){if(!i(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return l.alloc(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var r=l.allocUnsafe(t),o=0;for(n=0;n<e.length;++n){var s=e[n];if(!l.isBuffer(s))throw new TypeError('"list" argument must be an Array of Buffers');s.copy(r,o),o+=s.length}return r},l.byteLength=p,l.prototype._isBuffer=!0,l.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)g(this,t,t+1);return this},l.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)g(this,t,t+3),g(this,t+1,t+2);return this},l.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)g(this,t,t+7),g(this,t+1,t+6),g(this,t+2,t+5),g(this,t+3,t+4);return this},l.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?E(this,0,e):function(e,t,n){var r=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return T(this,t,n);case"utf8":case"utf-8":return E(this,t,n);case"ascii":return L(this,t,n);case"latin1":case"binary":return P(this,t,n);case"base64":return N(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return S(this,t,n);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}.apply(this,arguments)},l.prototype.equals=function(e){if(!l.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===l.compare(this,e)},l.prototype.inspect=function(){var e="",n=t.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,n).match(/.{2}/g).join(" "),this.length>n&&(e+=" ... ")),"<Buffer "+e+">"},l.prototype.compare=function(e,t,n,r,o){if(!l.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===o&&(o=this.length),t<0||n>e.length||r<0||o>this.length)throw new RangeError("out of range index");if(r>=o&&t>=n)return 0;if(r>=o)return-1;if(t>=n)return 1;if(this===e)return 0;for(var i=(o>>>=0)-(r>>>=0),s=(n>>>=0)-(t>>>=0),a=Math.min(i,s),u=this.slice(r,o),c=e.slice(t,n),d=0;d<a;++d)if(u[d]!==c[d]){i=u[d],s=c[d];break}return i<s?-1:s<i?1:0},l.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},l.prototype.indexOf=function(e,t,n){return y(this,e,t,n,!0)},l.prototype.lastIndexOf=function(e,t,n){return y(this,e,t,n,!1)},l.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)r=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(n)?(n|=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var o=this.length-t;if((void 0===n||n>o)&&(n=o),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var i=!1;;)switch(r){case"hex":return v(this,e,t,n);case"utf8":case"utf-8":return b(this,e,t,n);case"ascii":return k(this,e,t,n);case"latin1":case"binary":return x(this,e,t,n);case"base64":return w(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return A(this,e,t,n);default:if(i)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),i=!0}},l.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var _=4096;function L(e,t,n){var r="";n=Math.min(e.length,n);for(var o=t;o<n;++o)r+=String.fromCharCode(127&e[o]);return r}function P(e,t,n){var r="";n=Math.min(e.length,n);for(var o=t;o<n;++o)r+=String.fromCharCode(e[o]);return r}function T(e,t,n){var r=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>r)&&(n=r);for(var o="",i=t;i<n;++i)o+=X(e[i]);return o}function S(e,t,n){for(var r=e.slice(t,n),o="",i=0;i<r.length;i+=2)o+=String.fromCharCode(r[i]+256*r[i+1]);return o}function M(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function R(e,t,n,r,o,i){if(!l.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>o||t<i)throw new RangeError('"value" argument is out of bounds');if(n+r>e.length)throw new RangeError("Index out of range")}function C(e,t,n,r){t<0&&(t=65535+t+1);for(var o=0,i=Math.min(e.length-n,2);o<i;++o)e[n+o]=(t&255<<8*(r?o:1-o))>>>8*(r?o:1-o)}function B(e,t,n,r){t<0&&(t=4294967295+t+1);for(var o=0,i=Math.min(e.length-n,4);o<i;++o)e[n+o]=t>>>8*(r?o:3-o)&255}function I(e,t,n,r,o,i){if(n+r>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function O(e,t,n,r,i){return i||I(e,0,n,4),o.write(e,t,n,r,23,4),n+4}function Y(e,t,n,r,i){return i||I(e,0,n,8),o.write(e,t,n,r,52,8),n+8}l.prototype.slice=function(e,t){var n,r=this.length;if((e=~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),(t=void 0===t?r:~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e),l.TYPED_ARRAY_SUPPORT)(n=this.subarray(e,t)).__proto__=l.prototype;else{var o=t-e;n=new l(o,void 0);for(var i=0;i<o;++i)n[i]=this[i+e]}return n},l.prototype.readUIntLE=function(e,t,n){e|=0,t|=0,n||M(e,t,this.length);for(var r=this[e],o=1,i=0;++i<t&&(o*=256);)r+=this[e+i]*o;return r},l.prototype.readUIntBE=function(e,t,n){e|=0,t|=0,n||M(e,t,this.length);for(var r=this[e+--t],o=1;t>0&&(o*=256);)r+=this[e+--t]*o;return r},l.prototype.readUInt8=function(e,t){return t||M(e,1,this.length),this[e]},l.prototype.readUInt16LE=function(e,t){return t||M(e,2,this.length),this[e]|this[e+1]<<8},l.prototype.readUInt16BE=function(e,t){return t||M(e,2,this.length),this[e]<<8|this[e+1]},l.prototype.readUInt32LE=function(e,t){return t||M(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},l.prototype.readUInt32BE=function(e,t){return t||M(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},l.prototype.readIntLE=function(e,t,n){e|=0,t|=0,n||M(e,t,this.length);for(var r=this[e],o=1,i=0;++i<t&&(o*=256);)r+=this[e+i]*o;return r>=(o*=128)&&(r-=Math.pow(2,8*t)),r},l.prototype.readIntBE=function(e,t,n){e|=0,t|=0,n||M(e,t,this.length);for(var r=t,o=1,i=this[e+--r];r>0&&(o*=256);)i+=this[e+--r]*o;return i>=(o*=128)&&(i-=Math.pow(2,8*t)),i},l.prototype.readInt8=function(e,t){return t||M(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},l.prototype.readInt16LE=function(e,t){t||M(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},l.prototype.readInt16BE=function(e,t){t||M(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},l.prototype.readInt32LE=function(e,t){return t||M(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},l.prototype.readInt32BE=function(e,t){return t||M(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},l.prototype.readFloatLE=function(e,t){return t||M(e,4,this.length),o.read(this,e,!0,23,4)},l.prototype.readFloatBE=function(e,t){return t||M(e,4,this.length),o.read(this,e,!1,23,4)},l.prototype.readDoubleLE=function(e,t){return t||M(e,8,this.length),o.read(this,e,!0,52,8)},l.prototype.readDoubleBE=function(e,t){return t||M(e,8,this.length),o.read(this,e,!1,52,8)},l.prototype.writeUIntLE=function(e,t,n,r){(e=+e,t|=0,n|=0,r)||R(this,e,t,n,Math.pow(2,8*n)-1,0);var o=1,i=0;for(this[t]=255&e;++i<n&&(o*=256);)this[t+i]=e/o&255;return t+n},l.prototype.writeUIntBE=function(e,t,n,r){(e=+e,t|=0,n|=0,r)||R(this,e,t,n,Math.pow(2,8*n)-1,0);var o=n-1,i=1;for(this[t+o]=255&e;--o>=0&&(i*=256);)this[t+o]=e/i&255;return t+n},l.prototype.writeUInt8=function(e,t,n){return e=+e,t|=0,n||R(this,e,t,1,255,0),l.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},l.prototype.writeUInt16LE=function(e,t,n){return e=+e,t|=0,n||R(this,e,t,2,65535,0),l.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):C(this,e,t,!0),t+2},l.prototype.writeUInt16BE=function(e,t,n){return e=+e,t|=0,n||R(this,e,t,2,65535,0),l.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):C(this,e,t,!1),t+2},l.prototype.writeUInt32LE=function(e,t,n){return e=+e,t|=0,n||R(this,e,t,4,4294967295,0),l.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):B(this,e,t,!0),t+4},l.prototype.writeUInt32BE=function(e,t,n){return e=+e,t|=0,n||R(this,e,t,4,4294967295,0),l.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):B(this,e,t,!1),t+4},l.prototype.writeIntLE=function(e,t,n,r){if(e=+e,t|=0,!r){var o=Math.pow(2,8*n-1);R(this,e,t,n,o-1,-o)}var i=0,s=1,a=0;for(this[t]=255&e;++i<n&&(s*=256);)e<0&&0===a&&0!==this[t+i-1]&&(a=1),this[t+i]=(e/s>>0)-a&255;return t+n},l.prototype.writeIntBE=function(e,t,n,r){if(e=+e,t|=0,!r){var o=Math.pow(2,8*n-1);R(this,e,t,n,o-1,-o)}var i=n-1,s=1,a=0;for(this[t+i]=255&e;--i>=0&&(s*=256);)e<0&&0===a&&0!==this[t+i+1]&&(a=1),this[t+i]=(e/s>>0)-a&255;return t+n},l.prototype.writeInt8=function(e,t,n){return e=+e,t|=0,n||R(this,e,t,1,127,-128),l.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},l.prototype.writeInt16LE=function(e,t,n){return e=+e,t|=0,n||R(this,e,t,2,32767,-32768),l.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):C(this,e,t,!0),t+2},l.prototype.writeInt16BE=function(e,t,n){return e=+e,t|=0,n||R(this,e,t,2,32767,-32768),l.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):C(this,e,t,!1),t+2},l.prototype.writeInt32LE=function(e,t,n){return e=+e,t|=0,n||R(this,e,t,4,2147483647,-2147483648),l.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):B(this,e,t,!0),t+4},l.prototype.writeInt32BE=function(e,t,n){return e=+e,t|=0,n||R(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),l.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):B(this,e,t,!1),t+4},l.prototype.writeFloatLE=function(e,t,n){return O(this,e,t,!0,n)},l.prototype.writeFloatBE=function(e,t,n){return O(this,e,t,!1,n)},l.prototype.writeDoubleLE=function(e,t,n){return Y(this,e,t,!0,n)},l.prototype.writeDoubleBE=function(e,t,n){return Y(this,e,t,!1,n)},l.prototype.copy=function(e,t,n,r){if(n||(n=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);var o,i=r-n;if(this===e&&n<t&&t<r)for(o=i-1;o>=0;--o)e[o+t]=this[o+n];else if(i<1e3||!l.TYPED_ARRAY_SUPPORT)for(o=0;o<i;++o)e[o+t]=this[o+n];else Uint8Array.prototype.set.call(e,this.subarray(n,n+i),t);return i},l.prototype.fill=function(e,t,n,r){if("string"==typeof e){if("string"==typeof t?(r=t,t=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),1===e.length){var o=e.charCodeAt(0);o<256&&(e=o)}if(void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!l.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;var i;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(i=t;i<n;++i)this[i]=e;else{var s=l.isBuffer(e)?e:D(new l(e,r).toString()),a=s.length;for(i=0;i<n-t;++i)this[i+t]=s[i%a]}return this};var U=/[^+\/0-9A-Za-z-_]/g;function X(e){return e<16?"0"+e.toString(16):e.toString(16)}function D(e,t){var n;t=t||1/0;for(var r=e.length,o=null,i=[],s=0;s<r;++s){if((n=e.charCodeAt(s))>55295&&n<57344){if(!o){if(n>56319){(t-=3)>-1&&i.push(239,191,189);continue}if(s+1===r){(t-=3)>-1&&i.push(239,191,189);continue}o=n;continue}if(n<56320){(t-=3)>-1&&i.push(239,191,189),o=n;continue}n=65536+(o-55296<<10|n-56320)}else o&&(t-=3)>-1&&i.push(239,191,189);if(o=null,n<128){if((t-=1)<0)break;i.push(n)}else if(n<2048){if((t-=2)<0)break;i.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;i.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;i.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return i}function q(e){return r.toByteArray(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(U,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function F(e,t,n,r){for(var o=0;o<r&&!(o+n>=t.length||o>=e.length);++o)t[o+n]=e[o];return o}}).call(this,n(6))},function(e,t,n){"use strict";t.byteLength=function(e){var t=u(e),n=t[0],r=t[1];return 3*(n+r)/4-r},t.toByteArray=function(e){for(var t,n=u(e),r=n[0],s=n[1],a=new i(function(e,t,n){return 3*(t+n)/4-n}(0,r,s)),l=0,c=s>0?r-4:r,d=0;d<c;d+=4)t=o[e.charCodeAt(d)]<<18|o[e.charCodeAt(d+1)]<<12|o[e.charCodeAt(d+2)]<<6|o[e.charCodeAt(d+3)],a[l++]=t>>16&255,a[l++]=t>>8&255,a[l++]=255&t;2===s&&(t=o[e.charCodeAt(d)]<<2|o[e.charCodeAt(d+1)]>>4,a[l++]=255&t);1===s&&(t=o[e.charCodeAt(d)]<<10|o[e.charCodeAt(d+1)]<<4|o[e.charCodeAt(d+2)]>>2,a[l++]=t>>8&255,a[l++]=255&t);return a},t.fromByteArray=function(e){for(var t,n=e.length,o=n%3,i=[],s=0,a=n-o;s<a;s+=16383)i.push(c(e,s,s+16383>a?a:s+16383));1===o?(t=e[n-1],i.push(r[t>>2]+r[t<<4&63]+"==")):2===o&&(t=(e[n-2]<<8)+e[n-1],i.push(r[t>>10]+r[t>>4&63]+r[t<<2&63]+"="));return i.join("")};for(var r=[],o=[],i="undefined"!=typeof Uint8Array?Uint8Array:Array,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,l=s.length;a<l;++a)r[a]=s[a],o[s.charCodeAt(a)]=a;function u(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");return-1===n&&(n=t),[n,n===t?0:4-n%4]}function c(e,t,n){for(var o,i,s=[],a=t;a<n;a+=3)o=(e[a]<<16&16711680)+(e[a+1]<<8&65280)+(255&e[a+2]),s.push(r[(i=o)>>18&63]+r[i>>12&63]+r[i>>6&63]+r[63&i]);return s.join("")}o["-".charCodeAt(0)]=62,o["_".charCodeAt(0)]=63},function(e,t){t.read=function(e,t,n,r,o){var i,s,a=8*o-r-1,l=(1<<a)-1,u=l>>1,c=-7,d=n?o-1:0,h=n?-1:1,f=e[t+d];for(d+=h,i=f&(1<<-c)-1,f>>=-c,c+=a;c>0;i=256*i+e[t+d],d+=h,c-=8);for(s=i&(1<<-c)-1,i>>=-c,c+=r;c>0;s=256*s+e[t+d],d+=h,c-=8);if(0===i)i=1-u;else{if(i===l)return s?NaN:1/0*(f?-1:1);s+=Math.pow(2,r),i-=u}return(f?-1:1)*s*Math.pow(2,i-r)},t.write=function(e,t,n,r,o,i){var s,a,l,u=8*i-o-1,c=(1<<u)-1,d=c>>1,h=23===o?Math.pow(2,-24)-Math.pow(2,-77):0,f=r?0:i-1,p=r?1:-1,g=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,s=c):(s=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-s))<1&&(s--,l*=2),(t+=s+d>=1?h/l:h*Math.pow(2,1-d))*l>=2&&(s++,l/=2),s+d>=c?(a=0,s=c):s+d>=1?(a=(t*l-1)*Math.pow(2,o),s+=d):(a=t*Math.pow(2,d-1)*Math.pow(2,o),s=0));o>=8;e[n+f]=255&a,f+=p,a/=256,o-=8);for(s=s<<o|a,u+=o;u>0;e[n+f]=255&s,f+=p,s/=256,u-=8);e[n+f-p]|=128*g}},function(e,t){var n={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==n.call(e)}},function(e,t,n){for(var r=n(14),o=[],i={},s=0;s<256;s++)o[s]=(s+256).toString(16).substr(1),i[o[s]]=s;function a(e,t){var n=t||0,r=o;return r[e[n++]]+r[e[n++]]+r[e[n++]]+r[e[n++]]+"-"+r[e[n++]]+r[e[n++]]+"-"+r[e[n++]]+r[e[n++]]+"-"+r[e[n++]]+r[e[n++]]+"-"+r[e[n++]]+r[e[n++]]+r[e[n++]]+r[e[n++]]+r[e[n++]]+r[e[n++]]}var l=r(),u=[1|l[0],l[1],l[2],l[3],l[4],l[5]],c=16383&(l[6]<<8|l[7]),d=0,h=0;function f(e,t,n){var o=t&&n||0;"string"==typeof e&&(t="binary"==e?new Array(16):null,e=null);var i=(e=e||{}).random||(e.rng||r)();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,t)for(var s=0;s<16;s++)t[o+s]=i[s];return t||a(i)}var p=f;p.v1=function(e,t,n){var r=t&&n||0,o=t||[],i=void 0!==(e=e||{}).clockseq?e.clockseq:c,s=void 0!==e.msecs?e.msecs:(new Date).getTime(),l=void 0!==e.nsecs?e.nsecs:h+1,f=s-d+(l-h)/1e4;if(f<0&&void 0===e.clockseq&&(i=i+1&16383),(f<0||s>d)&&void 0===e.nsecs&&(l=0),l>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");d=s,h=l,c=i;var p=(1e4*(268435455&(s+=122192928e5))+l)%4294967296;o[r++]=p>>>24&255,o[r++]=p>>>16&255,o[r++]=p>>>8&255,o[r++]=255&p;var g=s/4294967296*1e4&268435455;o[r++]=g>>>8&255,o[r++]=255&g,o[r++]=g>>>24&15|16,o[r++]=g>>>16&255,o[r++]=i>>>8|128,o[r++]=255&i;for(var y=e.node||u,m=0;m<6;m++)o[r+m]=y[m];return t||a(o)},p.v4=f,p.parse=function(e,t,n){var r=t&&n||0,o=0;for(t=t||[],e.toLowerCase().replace(/[0-9a-f]{2}/g,function(e){o<16&&(t[r+o++]=i[e])});o<16;)t[r+o++]=0;return t},p.unparse=a,e.exports=p},function(e,t,n){(function(t){var n,r=t.crypto||t.msCrypto;if(r&&r.getRandomValues){var o=new Uint8Array(16);n=function(){return r.getRandomValues(o),o}}if(!n){var i=new Array(16);n=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),i[t]=e>>>((3&t)<<3)&255;return i}}e.exports=n}).call(this,n(6))},function(e,t,n){},function(e,t,n){"use strict";n.r(t);var o=n(1),i=n.n(o),s=n(0),a=n.n(s),l=n(2),u=n.n(l),c=(n(15),n(7)),d=n.n(c);function h(e,t){var n,r,o=!1,i=u.a.nice(),s=null,l="right",c=null,f=null;return"function"==typeof t?n=t:(n=(t=t||{}).onOpen,r=t.onClose),"rootElement"in t&&(s=t.rootElement),"pos"in t&&(c=t.pos),"orientation"in t&&(l=t.orientation),"parentStart"in t&&(f=t.parentStart),a.a.selectAll(".d3-context-menu-"+i).data([1]).enter().append("div").classed("d3-context-menu",!0).classed("d3-context-menu-"+i,!0),a.a.select("body").on("click.d3-context-menu-"+i,function(){o?o=!1:(console.log("body click close"),a.a.select(".d3-context-menu-"+i).style("display","none"),l="right",r&&r())}),function(t,u){var p=arguments.length>2&&void 0!==arguments[2]&&arguments[2],g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){},y=this,m=null,v=this;m=null==s?a.a.mouse(this):a.a.mouse(s),g;var b=null;o=p,a.a.selectAll(".d3-context-menu-"+i).html("");var k=a.a.selectAll(".d3-context-menu-"+i).on("contextmenu",function(e){console.log("context-menu close"),a.a.select(".d3-context-menu-"+i).style("display","none"),l="right",a.a.event.preventDefault(),a.a.event.stopPropagation()}).append("ul");if(k.selectAll("li").data("function"==typeof e?e(t):e).enter().append("li").attr("class",function(e){console.log("d:",e);var t="";return e.divider&&(t+=" is-divider"),e.disabled&&(t+=" is-disabled"),e.action||(t+=" is-header"),"children"in e&&(t+=" d3-context-menu-recursive"),t}).html(function(e){return e.divider?"<hr>":(e.title||console.error("No title attribute set. Check the spelling of your options."),"string"==typeof e.title?e.title:e.title(t))}).on("click",function(e,n){e.disabled||e.action&&(e.action(y,t,u,m),console.log("click close"),a.a.selectAll(".d3-context-menu").style("display","none"),l="right",r&&r())}).on("mouseenter",function(e,n){if(a.a.select(this).classed("d3-context-menu-selected",!0),null!=b){if(a.a.select(".d3-context-menu-"+i).selectAll("li").classed("d3-context-menu-selected",!1),void 0===e.children)return console.log("no children close"),a.a.select(".d3-context-menu-"+b).style("display","none"),void(b=null);if(e.childUid==b)return;console.log("open different child menu close"),a.a.select(".d3-context-menu-"+b).style("display","none"),b=null}if(void 0!==e.children){var r=this.getBoundingClientRect(),o=null;o=h(e.children,"left"==l?{rootElement:v,pos:[r.left+window.pageXOffset,r.top-2+window.pageYOffset],orientation:"left"}:{pos:[r.left+r.width+window.pageXOffset,r.top-2+window.pageYOffset],rootElement:v,parentStart:[r.left+window.pageXOffset,r.top-2+window.pageYOffset]}),e.childUid=o.apply(this,[t,n,!0,function(){}]),b=e.childUid}a.a.select(this).classed("d3-context-menu-selected",!0)}).on("mouseleave",function(e,t){null==b&&a.a.select(this).classed("d3-context-menu-selected",!1)}),k.selectAll(".d3-context-menu-recursive").append("img").attr("src",d.a).attr("width","14px").attr("height","14px").style("position","absolute").style("right","5px"),n&&!1===n(t,u))return i;var x=a.a.select(".d3-context-menu-"+i).style("display","block");null==c?a.a.select(".d3-context-menu-"+i).style("left",a.a.event.pageX-2+"px").style("top",a.a.event.pageY-2+"px"):a.a.select(".d3-context-menu-"+i).style("left",c[0]+"px").style("top",c[1]+"px");var w=x.node().getBoundingClientRect();return(w.left+w.width>window.innerWidth||"left"==l)&&(l="left",null==c?a.a.select(".d3-context-menu-"+i).style("left",a.a.event.pageX-2-w.width+"px").style("top",a.a.event.pageY-2+"px"):null!=f?a.a.select(".d3-context-menu-"+i).style("left",f[0]-w.width+"px").style("top",f[1]+"px"):a.a.select(".d3-context-menu-"+i).style("left",c[0]-w.width+"px").style("top",c[1]+"px")),o?i:(a.a.event.preventDefault(),a.a.event.stopPropagation(),i)}}var f=function(e,t){return e-t};var p=new function(){var e=this;e.bracketLeft="([{<ABCDEFGHIJKLMNOPQRSTUVWXYZ".split(""),e.bracketRight=")]}>abcdefghijklmnopqrstuvwxyz".split(""),e.inverseBrackets=function(e){for(var t={},n=0;n<e.length;n++)t[e[n]]=n;return t},e.maximumMatching=function(e){for(var t=e[0],n=new Array(t+1),r=0;r<=t;r++){n[r]=new Array(t+1);for(var o=r;o<=t;o++)n[r][o]=0}var i=0;for(r=t-0-1;r>0;r--)for(o=r+0+1;o<=t;o++){i=n[r][o-1];for(var s=o-0-1;s>=r;s--)e[s]===o&&(i=Math.max(i,(s>r?n[r][s-1]:0)+1+(o-s-1>0?n[s+1][o-1]:0)));n[r][o]=i}return i=n[1][t],n},e.backtrackMaximumMatching=function(t,n){var r=Array.apply(null,Array(t.length)).map(function(){return 0});return e.mmBt(t,r,n,1,t.length-1),r},e.mmBt=function(t,n,r,o,i){var s=t[o][i];if(!(i-o-1<0))if(t[o][i-1]!=s){for(var a=i-0-1;a>=o;a--)if(r[i]===a&&(a>o?t[o][a-1]:0)+(i-a-1>0?t[a+1][i-1]:0)+1==s)return n[a]=i,n[i]=a,o<a&&e.mmBt(t,n,r,o,a-1),void e.mmBt(t,n,r,a+1,i-1);console.log("FAILED!!!"+o+","+i+": backtracking failed!")}else e.mmBt(t,n,r,o,i-1)},e.dotbracketToPairtable=function(t){var n=Array.apply(null,new Array(t.length+1)).map(Number.prototype.valueOf,0);n[0]=t.length;for(var r={},o=0;o<e.bracketLeft.length;o++)r[o]=[];var i=e.inverseBrackets(e.bracketLeft),s=e.inverseBrackets(e.bracketRight);for(o=0;o<t.length;o++){var a=t[o],l=o+1;if("."==a||"o"==a)n[l]=0;else if(a in i)r[i[a]].push(l);else{if(!(a in s))throw"Unknown symbol in dotbracket string";var u=r[s[a]].pop();n[l]=u,n[u]=l}}for(var c in r)if(r[c].length>0)throw"Unmatched base at position "+r[c][0];return n},e.insertIntoStack=function(e,t,n){for(var r=0;e[r].length>0&&e[r][e[r].length-1]<n;)r+=1;return e[r].push(n),r},e.deleteFromStack=function(e,t){for(var n=0;0===e[n].length||e[n][e[n].length-1]!=t;)n+=1;return e[n].pop(),n},e.pairtableToDotbracket=function(t){for(var n={},r=0;r<t[0];r++)n[r]=[];var o={},i="";for(r=1;r<t[0]+1;r++){if(0!==t[r]&&t[r]in o)throw"Invalid pairtable contains duplicate entries";o[t[r]]=!0,0===t[r]?i+=".":t[r]>r?i+=e.bracketLeft[e.insertIntoStack(n,r,t[r])]:i+=e.bracketRight[e.deleteFromStack(n,r)]}return i},e.findUnmatched=function(t,n,r){for(var o=[],i=[],s=n,a=r,l=n;l<=r;l++)0!==t[l]&&(t[l]<n||t[l]>r)&&i.push([l,t[l]]);for(l=s;l<=a;l++){for(;0===t[l]&&l<=a;)l++;for(r=t[l];t[l]===r;)l++,r--;o=o.concat(e.findUnmatched(t,l,r))}return i.length>0&&o.push(i),o},e.removePseudoknotsFromPairtable=function(t){for(var n=e.maximumMatching(t),r=e.backtrackMaximumMatching(n,t),o=[],i=1;i<t.length;i++)t[i]<i||r[i]!=t[i]&&(o.push([i,t[i]]),t[t[i]]=0,t[i]=0);return o},e.ptToElements=function(t,n,r,o,i){var s=[],a=[r-1],l=[o+1];if(arguments.length<5&&(i=[]),r>o)return[];for(;0===t[r];r++)a.push(r);for(;0===t[o];o--)l.push(o);if(r>o){if(a.push(r),0===n)return[["e",n,a.sort(f)]];for(var u=!1,c=[],d=[],h=0;h<a.length;h++)u?d.push(a[h]):c.push(a[h]),i.indexOf(a[h])>=0&&(u=!0);return[["h",n,a.sort(f)]]}if(t[r]!=o){var p=a;for(h=r,p.push(h);h<=o;){for(s=s.concat(e.ptToElements(t,n,h,t[h],i)),p.push(t[h]),h=t[h]+1;0===t[h]&&h<=o;h++)p.push(h);p.push(h)}return p.pop(),(p=p.concat(l)).length>0&&(0===n?s.push(["e",n,p.sort(f)]):s.push(["m",n,p.sort(f)])),s}t[r]===o&&(a.push(r),l.push(o),a.concat(l).length>4&&(0===n?s.push(["e",n,a.concat(l).sort(f)]):s.push(["i",n,a.concat(l).sort(f)])));for(var g=[];t[r]===o&&r<o;)g.push(r),g.push(o),r+=1,o-=1,n+=1;return a=[r-1],l=[o+1],s.push(["s",n,g.sort(f)]),s.concat(e.ptToElements(t,n,r,o,i))}};function g(e){var t=this;return t.colorsText=e,t.parseRange=function(e){for(var t=e.split(","),n=[],r=0;r<t.length;r++){var o=t[r].split("-");if(1==o.length)n.push(parseInt(o[0]));else if(2==o.length)for(var i=parseInt(o[0]),s=parseInt(o[1]),a=i;a<=s;a++)n.push(a);else console.log("Malformed range (too many dashes):",e)}return n},t.parseColorText=function(e){for(var n=e.split("\n"),r="",o=1,i={colorValues:{"":{}},range:["white","steelblue"]},s=[],a=0;a<n.length;a++)if(">"!=n[a][0])for(var l=n[a].trim().split(/[\s]+/),u=0;u<l.length;u++)if(isNaN(l[u])){if(0===l[u].search("range")){var c=l[u].split("=")[1].split(":");i.range=[c[0],c[1]];continue}if(0==l[u].search("domain")){var d=l[u].split("=")[1].split(":");i.domain=[d[0],d[1]];continue}for(var h=l[u].split(":"),f=t.parseRange(h[0]),p=h[1],g=0;g<f.length;g++)isNaN(p)?i.colorValues[r][f[g]]=p:(i.colorValues[r][f[g]]=+p,s.push(Number(p)))}else i.colorValues[r][o]=Number(l[u]),o+=1,s.push(Number(l[u]));else r=n[a].trim().slice(1),o=1,i.colorValues[r]={};return"domain"in i||(i.domain=[Math.min.apply(null,s),Math.max.apply(null,s)]),t.colorsJson=i,t},t.normalizeColors=function(){var e;for(var n in t.colorsJson){var r=Number.MAX_VALUE,o=Number.MIN_VALUE;for(var i in t.colorsJson.colorValues[n])"number"==typeof(e=t.colorsJson.colorValues[n][i])&&(e<r&&(r=e),e>o&&(o=e));for(i in t.colorsJson.colorValues[n])"number"==typeof(e=t.colorsJson.colorValues[n][i])&&(t.colorsJson.colorValues[n][i]=(e-r)/(o-r))}return t},t.parseColorText(t.colorsText),t}var y=function(e,t){return e-t};function m(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,o=this;o.type="rna",o.circularizeExternal=!1,o.seq=e,o.dotbracket=t,o.structName=n,o.circular=!1,"*"==o.dotbracket.slice(-1)&&(o.dotbracket=o.dotbracket.slice(0,-1),o.circular=!0),o.uid=u.a.nice(),o.elements=[],o.pseudoknotPairs=[],o.nucsToNodes={},o.addUids=function(e){for(var t=o.nodes.filter(function(e){return"nucleotide"==e.nodeType}),n=0;n<e.length&&n<t.length;n++)t[n].uid=e[n];return o},o.computePairtable=function(){o.pairtable=p.dotbracketToPairtable(o.dotbracket)},o.removeBreaks=function(e){for(var t=[],n=-1;(n=e.indexOf("&"))>=0;)t.push(n),e=e.substring(0,n)+e.substring(n+1,e.length);return{targetString:e,breaks:t}};var i=o.removeBreaks(o.dotbracket);o.dotbracket=i.targetString,o.dotBracketBreaks=i.breaks,i=o.removeBreaks(o.seq),o.seq=i.targetString,o.seqBreaks=i.breaks,o.rnaLength=o.dotbracket.length,function(e,t){if(e===t)return!0;if(null===e||null===t)return!1;if(e.length!=t.length)return!1;for(var n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}(o.dotBracketBreaks,o.seqBreaks)||(console.log("WARNING: Sequence and structure breaks not equal"),console.log("WARNING: Using the breaks in the structure")),o.computePairtable(),o.addPositions=function(e,t){for(var n=o.nodes.filter(function(t){return t.nodeType==e}),r=0;r<n.length;r++)n[r].x=t[r][0],n[r].y=t[r][1];return o},o.breakNodesToFakeNodes=function(){for(var e=o.nodes.filter(function(e){return"nucleotide"==e.nodeType}),t=0;t<e.length;t++)o.dotBracketBreaks.indexOf(t)>=0&&(e[t].nodeType="middle",e[t+1].nodeType="middle");for(var n=function(e){i=!1;for(var t=0;t<o.elements[e][2].length;t++)o.dotBracketBreaks.indexOf(o.elements[e][2][t])>=0&&(i=!0);i?o.elements[e][2].map(function(e){0!=e&&(o.nodes[e-1].elemType="e")}):o.elements[e][2].map(function(t){0!=t&&(o.nodes[t-1].elemType=o.elements[e][0])})},r=0;r<o.elements.length;r++){var i;n(r)}return o},o.getPositions=function(e){for(var t=[],n=o.nodes.filter(function(t){return t.nodeType==e}),r=0;r<n.length;r++)t.push([n[r].x,n[r].y]);return t},o.getUids=function(){for(var e=[],t=0;t<o.dotbracket.length;t++)e.push(o.nodes[t].uid);return e},o.reinforceStems=function(){for(var e=o.pairtable,t=o.elements.filter(function(e){return"s"==e[0]&&e[2].length>=4}),n=0;n<t.length;n++)for(var r=t[n][2],i=r.slice(0,r.length/2),s=0;s<i.length-1;s++)o.addFakeNode([i[s],i[s+1],e[i[s+1]],e[i[s]]]);return o},o.reinforceLoops=function(){for(var e=function(e){return 0!==e&&e<=o.dotbracket.length},t=0;t<o.elements.length;t++)if("s"!=o.elements[t][0]&&(o.circularizeExternal||"e"!=o.elements[t][0])){var n=o.elements[t][2].filter(e);if("e"==o.elements[t][0]){var r={name:"",num:-3,radius:0,rna:o,nodeType:"middle",elemType:"f",nucs:[],x:o.nodes[o.rnaLength-1].x,y:o.nodes[o.rnaLength-1].y,px:o.nodes[o.rnaLength-1].px,py:o.nodes[o.rnaLength-1].py,uid:u.a.nice()},i={name:"",num:-2,radius:0,rna:o,nodeType:"middle",elemType:"f",nucs:[],x:o.nodes[0].x,y:o.nodes[0].y,px:o.nodes[0].px,py:o.nodes[0].py,uid:u.a.nice()};n.push(o.nodes.length+1),n.push(o.nodes.length+2),o.nodes.push(r),o.nodes.push(i)}o.addFakeNode(n)}return o},o.updateLinkUids=function(){for(var e=0;e<o.links.length;e++)o.links[e].uid=o.links[e].source.uid+o.links[e].target.uid;return o},o.addFakeNode=function(e){for(var t=6.283/(2*e.length),n=18/(2*Math.tan(t)),r="",i=0;i<e.length;i++)r+=o.nodes[e[i]-1].uid;var s={name:"",num:-1,radius:n,rna:o,nodeType:"middle",elemType:"f",nucs:e,uid:r};o.nodes.push(s);var a=0,l=0,c=0;t=3.14159*(e.length-2)/(2*e.length),n=.5/Math.cos(t);for(var d=0;d<e.length;d++)if(!(0===e[d]||e[d]>o.dotbracket.length)){o.links.push({source:o.nodes[e[d]-1],target:o.nodes[o.nodes.length-1],linkType:"fake",value:n,uid:u.a.nice()}),e.length>4&&o.links.push({source:o.nodes[e[d]-1],target:o.nodes[e[(d+Math.floor(e.length/2))%e.length]-1],linkType:"fake",value:2*n,uid:u.a.nice()});var h=3.14159*(e.length-2)/e.length,f=2*Math.cos(1.570795-h/2);o.links.push({source:o.nodes[e[d]-1],target:o.nodes[e[(d+2)%e.length]-1],linkType:"fake",value:f});var p=o.nodes[e[d]-1];"x"in p&&(a+=p.x,l+=p.y,c+=1)}return c>0&&(s.x=a/c,s.y=l/c,s.px=s.x,s.py=s.y),o},o.connectFakeNodes=function(){for(var e={},t=o.nodes.filter(function(e){return"middle"==e.nodeType}),n={},r=1;r<=o.nodes.length;r++)e[r]=[];for(r=0;r<t.length;r++)for(var i=t[r],s=0;s<i.nucs.length;s++){for(var a=i.nucs[s],l=0;l<e[a].length;l++)if(!(JSON.stringify([e[a][l].uid,i.uid].sort())in n)){var u=e[a][l].radius+i.radius;o.links.push({source:e[a][l],target:i,value:u/18,linkType:"fake_fake"}),n[JSON.stringify([e[a][l].uid,i.uid].sort())]=!0}e[a].push(i)}return o},o.addExtraLinks=function(e){if(void 0===e)return o;for(var t=0;t<e.length;t++){var n={source:o.getNodeFromNucleotides(e[t].from),target:o.getNodeFromNucleotides(e[t].to),linkType:"extra",extraLinkType:e[t].linkType,uid:u.a.nice()};o.links.push(n)}return o},o.elementsToJson=function(){var e=o.pairtable;o.elements;o.nodes=[],o.links=[];var t={};o.elements.sort();for(var n=0;n<o.elements.length;n++)for(var i=o.elements[n][2],s=0;s<i.length;s++)t[i[s]]=o.elements[n][0];for(var a=1;a<=e[0];a++){var l=o.seq[a-1];(o.dotBracketBreaks.indexOf(a-1)>=0||o.dotBracketBreaks.indexOf(a-2)>=0)&&(l=""),o.nodes.push({name:l,num:r+a-1,radius:5,rna:o,nodeType:"nucleotide",structName:o.structName,elemType:t[a],uid:u.a.nice(),linked:!1})}for(var c=0;c<o.nodes.length;c++)o.nodes[c].prevNode=0===c?null:o.nodes[c-1],c==o.nodes.length-1?o.nodes[c].nextNode=null:o.nodes[c].nextNode=o.nodes[c+1];for(var d=1;d<=e[0];d++)0!==e[d]&&o.links.push({source:o.nodes[d-1],target:o.nodes[e[d]-1],linkType:"basepair",value:1,uid:u.a.nice()}),d>1&&-1===o.dotBracketBreaks.indexOf(d-1)&&-1==o.dotBracketBreaks.indexOf(d-2)&&-1==o.dotBracketBreaks.indexOf(d-3)&&(o.links.push({source:o.nodes[d-2],target:o.nodes[d-1],linkType:"backbone",value:1,uid:u.a.nice()}),o.nodes[d-1].linked=!0);for(var h=0;h<o.pseudoknotPairs.length;h++)o.links.push({source:o.nodes[o.pseudoknotPairs[h][0]-1],target:o.nodes[o.pseudoknotPairs[h][1]-1],linkType:"pseudoknot",value:1,uid:u.a.nice()});return o.circular&&o.links.push({source:o.nodes[0],target:o.nodes[o.rnaLength-1],linkType:"backbone",value:1,uid:u.a.nice()}),o},o.ptToElements=function(e,t,n,r){var i=[],s=[n-1],a=[r+1];if(n>r)return[];for(;0===e[n];n++)s.push(n);for(;0===e[r];r--)a.push(r);if(n>r){if(s.push(n),0===t)return[["e",t,s.sort(y)]];for(var l=!1,u=[],c=[],d=0;d<s.length;d++)l?c.push(s[d]):u.push(s[d]),o.dotBracketBreaks.indexOf(s[d])>=0&&(l=!0);return[["h",t,s.sort(y)]]}if(e[n]!=r){var h=s;d=n;for(h.push(d);d<=r;){for(i=i.concat(o.ptToElements(e,t,d,e[d])),h.push(e[d]),d=e[d]+1;0===e[d]&&d<=r;d++)h.push(d);h.push(d)}return h.pop(),(h=h.concat(a)).length>0&&(0===t?i.push(["e",t,h.sort(y)]):i.push(["m",t,h.sort(y)])),i}e[n]===r&&(s.push(n),a.push(r),s.concat(a).length>4&&(0===t?i.push(["e",t,s.concat(a).sort(y)]):i.push(["i",t,s.concat(a).sort(y)])));for(var f=[];e[n]===r&&n<r;)f.push(n),f.push(r),n+=1,r-=1,t+=1;return s=[n-1],a=[r+1],i.push(["s",t,f.sort(y)]),i.concat(o.ptToElements(e,t,n,r))},o.addLabels=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;if(0===t)return o;for(var n=1;n<=o.rnaLength;n++)if(n%t==0){var r,i,s=o.nodes[n-1],a=void 0,l=void 0,c=void 0,d=void 0;1==o.rnaLength?(d=[s.x-15,s.y],c=[s.x-15,s.y]):(a=1==n?o.nodes[o.rnaLength-1]:o.nodes[n-2],l=n==o.rnaLength?o.nodes[0]:o.nodes[n],0!==o.pairtable[l.num-e+1]&&0!==o.pairtable[a.num-e+1]&&0!==o.pairtable[s.num-e+1]&&(a=l=o.nodes[o.pairtable[s.num-e+1]-1]),0===o.pairtable[s.num-e+1]||0!==o.pairtable[l.num-e+1]&&0!==o.pairtable[a.num-e+1]?(d=[l.x-s.x,l.y-s.y],c=[a.x-s.x,a.y-s.y]):(d=[s.x-l.x,s.y-l.y],c=[s.x-a.x,s.y-a.y]));var h=[d[0]+c[0],d[1]+c[1]],f=Math.sqrt(h[0]*h[0]+h[1]*h[1]),p=[h[0]/f,h[1]/f],g=[-15*p[0],-15*p[1]];r=o.nodes[n-1].x+g[0],i=o.nodes[n-1].y+g[1];var y={name:n+e-1,num:-1,radius:6,rna:o,nodeType:"label",structName:o.structName,elemType:"l",x:r,y:i,px:r,py:i,uid:u.a.nice()},m={source:o.nodes[n-1],target:y,value:1,linkType:"label_link",uid:u.a.nice()};o.nodes.push(y),o.links.push(m)}return o},o.recalculateElements=function(){if(o.removePseudoknots(),o.elements=o.ptToElements(o.pairtable,0,1,o.dotbracket.length),o.circular){var e=o.elements.filter(function(e){if("e"==e[0])return!0});if(e.length>0){eloop=e[0],nucs=eloop[2].sort(y),prev=nucs[0],hloop=!0,numGreater=0;for(var t=1;t<nucs.length;t++)nucs[t]-prev>1&&(numGreater+=1),prev=nucs[t];1==numGreater?eloop[0]="h":2==numGreater?eloop[0]="i":eloop[0]="m"}}return o},o.reassignLinkUids=function(){for(var e=0;e<o.links.length;e++)o.links[e].uid=o.links[e].source.uid+o.links[e].target.uid;return o},o.removePseudoknots=function(){return o.pairtable.length>1&&(o.pseudoknotPairs=o.pseudoknotPairs.concat(p.removePseudoknotsFromPairtable(o.pairtable))),o},o.addPseudoknots=function(){for(var e=o.pairtable,t=o.pseudoknotPairs,n=0;n<t.length;n++)e[t[n][0]]=t[n][1],e[t[n][1]]=t[n][0];return o.pseudoknotPairs=[],o},o.addName=function(e){return void 0===e?(o.name="",o):(o.name=e,o)},o.rnaLength>0&&o.recalculateElements(),o.getNodeFromNucleotides=function(e){if("[object Array]"===Object.prototype.toString.call(e)){for(var t=0;t<o.nodes.length;t++)if("nucs"in o.nodes[t]&&o.nodes[t].nucs.equals(e))return o.nodes[t]}else for(var n=0;n<o.nodes.length;n++)if(o.nodes[n].num==e)return o.nodes[n];return console.log("ERROR: No node found for nucs:",e),null}}function v(e){var t,n,r,o=[],i=[];n=e[0];var s=Array.apply(null,new Array(n+5)).map(Number.prototype.valueOf,0),a=Array.apply(null,new Array(16+Math.floor(n/5))).map(Number.prototype.valueOf,0),l=Array.apply(null,new Array(16+Math.floor(n/5))).map(Number.prototype.valueOf,0),u=0,c=0,d=Math.PI/2;!function e(t,n,r){var o,i,h,f,p,g,y,m,v,b,k,x,w=2,A=0,N=0,E=Array.apply(null,new Array(3+2*Math.floor((n-t)/5))).map(Number.prototype.valueOf,0);for(o=t-1,n++;t!=n;)if((i=r[t])&&0!=t){w+=2,h=t,f=i,E[++A]=h,E[++A]=f,t=i+1,p=h,g=f,m=0;do{h++,f--,m++}while(r[h]==f&&r[h]>h);if(y=m-2,m>=2&&(s[p+1+y]+=d,s[g-1-y]+=d,s[p]+=d,s[g]+=d,m>2))for(;y>=1;y--)s[p+y]=Math.PI,s[g-y]=Math.PI;l[++c]=m,h<=f&&e(h,f,r)}else t++,w++,N++;for(x=Math.PI*(w-2)/w,E[++A]=n,v=o<0?0:o,b=1;b<=A;b++){for(k=E[b]-v,y=0;y<=k;y++)s[v+y]+=x;if(b>A)break;v=E[++b]}a[++u]=N}(0,n+1,e),a[u]-=2,r=0,o[0]=100,i[0]=100;var h=[];for(h.push([o[0],i[0]]),t=1;t<n;t++)o[t]=o[t-1]+15*Math.cos(r),i[t]=i[t-1]+15*Math.sin(r),h.push([o[t],i[t]]),r+=Math.PI-s[t+1];return h}function b(){this.radius=null,this.loopnumber=null,this.next=null,this.prev=null}void 0===String.prototype.trim&&(String.prototype.trim=function(){return String(this).replace(/^\s+|\s+$/g,"")}),b.prototype.getRadius=function(){return this.radius},b.prototype.setRadius=function(e){this.radius=e},b.prototype.getLoopnumber=function(){return this.loopnumber},b.prototype.setLoopnumber=function(e){this.loopnumber=e},b.prototype.getNext=function(){return this.next},b.prototype.setNext=function(e){this.next=e},b.prototype.getPrev=function(){return this.prev},b.prototype.setPrev=function(e){this.prev=e};var k=n(3),x=n(5);function w(){this.mate=null,this.x=null,this.y=null,this.extracted=null,this.region=new x.a}w.prototype.getMate=function(){return this.mate},w.prototype.setMate=function(e){this.mate=e},w.prototype.getX=function(){return this.x},w.prototype.setX=function(e){this.x=e},w.prototype.getY=function(){return this.y},w.prototype.setY=function(e){this.y=e},w.prototype.isExtracted=function(){return this.extracted},w.prototype.setExtracted=function(e){this.extracted=e},w.prototype.getRegion=function(){return this.region},w.prototype.setRegion=function(e){this.region=e};var A=n(4);function N(){this.ANUM=9999,this.MAXITER=500,this.bases=[],this.nbase=null,this.nregion=null,this.loop_count=null,this.root=new A.a,this.loops=[],this.regions=[],this.rlphead=new b,this.lencut=.8,this.RADIUS_REDUCTION_FACTOR=1.4,this.angleinc=null,this._h=null,this.HELIX_FACTOR=.6,this.BACKBONE_DISTANCE=27}function E(e){var t=null,n=null,r=null;if(e.getNconnection()<=1)return 0;if(e.isMark())return-1;e.setMark(!0),t=0,n=0;for(var o=0;null!=e.getConnection(o);o++)(r=E(e.getConnection(o).getLoop()))>=0&&(1==++t?n=r:n>r&&(n=r));return e.setMark(!1),n+1}function _(e,t){var n=this;if(n.options={editable:!1,displayAllLinks:!1,labelInterval:10,applyForce:!0,chargeDistance:110,friction:.35,middleCharge:-30,otherCharge:-30,linkDistanceMultiplier:15,initialSize:null,layout:"standard-polygonal",allowPanningAndZooming:!0,transitionDuration:500,maxNodeRadius:80,resizeSvgOnResize:!0},arguments.length>1)for(var o in t)n.options.hasOwnProperty(o)&&(n.options[o]=t[o]);if(null!==n.options.initialSize?(n.options.svgW=n.options.initialSize[0],n.options.svgH=n.options.initialSize[1]):(n.options.svgW=800,n.options.svgH=800),1==n.options.editable){var s=[{title:"Add Node",action:function(e,t,n,r){},children:[{title:"A",action:function(e,t,r,o){console.log("mousePos:",o,n.options.svgW,n.options.svgH);var i=[y.invert(o[0]),b.invert(o[1])];console.log("canvasMousePos",i),n.addRNA(".",{sequence:"A",centerPos:i})}},{title:"C",action:function(e,t,r,o){console.log("mousePos:",o,n.options.svgW,n.options.svgH);var i=[y.invert(o[0]),b.invert(o[1])];console.log("canvasMousePos",i),n.addRNA(".",{sequence:"C",centerPos:i})}},{title:"G",action:function(e,t,r,o){console.log("mousePos:",o,n.options.svgW,n.options.svgH);var i=[y.invert(o[0]),b.invert(o[1])];console.log("canvasMousePos",i),n.addRNA(".",{sequence:"G",centerPos:i})}},{title:"U",action:function(e,t,r,o){console.log("mousePos:",o,n.options.svgW,n.options.svgH);var i=[y.invert(o[0]),b.invert(o[1])];console.log("canvasMousePos",i),n.addRNA(".",{sequence:"U",centerPos:i})}}],disabled:!1}],l=[{title:"Delete Node",action:function(e,t,r){n.deleteNode(t)},disabled:!1},{title:"Change Node",action:function(e,t,n){console.log("You have clicked the second item!"),console.log("The data for this circle is: "+t)},children:[{title:"A",action:function(e,t,r){n.changeNode("A",t)}},{title:"C",action:function(e,t,r){n.changeNode("C",t)}},{title:"G",action:function(e,t,r){n.changeNode("G",t)}},{title:"U",action:function(e,t,r){n.changeNode("U",t)}}]},{title:"Insert Before",action:function(e,t,n){},children:[{title:"A",action:function(e,t,r){n.insertNodeBeforeOrAfter("A",t,-1)}},{title:"C",action:function(e,t,r){n.insertNodeBeforeOrAfter("C",t,-1)}},{title:"G",action:function(e,t,r){n.insertNodeBeforeOrAfter("G",t,-1)}},{title:"U",action:function(e,t,r){n.insertNodeBeforeOrAfter("U",t,-1)}}]},{title:"Insert After",action:function(e,t,n){console.log("d:",t)},children:[{title:"A",action:function(e,t,r){n.insertNodeBeforeOrAfter("A",t,0)}},{title:"C",action:function(e,t,r){n.insertNodeBeforeOrAfter("C",t,0)}},{title:"G",action:function(e,t,r){n.insertNodeBeforeOrAfter("G",t,0)}},{title:"U",action:function(e,t,r){n.insertNodeBeforeOrAfter("U",t,0)}}]}];n.nodeContextMenu=h(l),n.backgroundContextMenu=h(s)}else console.log("empty context menu"),n.nodeContextMenu=function(){};a.a.scale.category20();var c=null,d=null,f=!1,y=a.a.scale.linear().domain([0,n.options.svgW]).range([0,n.options.svgW]),b=a.a.scale.linear().domain([0,n.options.svgH]).range([0,n.options.svgH]),k=n.graph={nodes:[],links:[]};function x(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function w(e){var t=e,n=e.prevNode;if(null!==n&&e.linked){var r=[-(t.x-n.x),-(t.y-n.y)];if(0!=r[0]||0!=r[1]){var o=[-(r=[r[0]/x(r),r[1]/x(r)])[1],r[0]],i=[e.radius*r[0],e.radius*r[1]],s="M"+(i[0]+6*(r[0]+o[0])/2)+","+(i[1]+6*(r[1]+o[1])/2)+"L"+i[0]+","+i[1]+"L"+(i[0]+6*(r[0]-o[0])/2)+","+(i[1]+6*(r[1]-o[1])/2);a.a.select(this).attr("d",s)}}}function A(e){return"basepair"==e.linkType||"backbone"==e.linkType||"intermolecule"==e.linkType||"pseudoknot"==e.linkType||"label_link"==e.linkType||"external"==e.linkType||"chain_chain"==e.linkType}function E(e,t,n){if(e.hasOwnProperty(t.num)){var r=parseFloat(e[t.num]);return isNaN(r)?e[t.num]:n(r)}return"white"}n.linkStrengths={pseudoknot:0,proteinChain:0,chainChain:0,intermolecule:10,external:0,other:10},n.displayParameters={displayBackground:"true",displayNumbering:"true",displayNodeOutline:"true",displayNodeLabel:"true",displayLinks:"true",displayPseudoknotLinks:"true",displayProteinLinks:"true"},n.colorScheme="structure",n.customColors={},n.animation=n.options.applyForce,n.deaf=!1,n.rnas={},n.extraLinks=[],Array.prototype.equals=function(e){if(!e)return!1;if(this.length!=e.length)return!1;for(var t=0,n=this.length;t<n;t++)if(this[t]instanceof Array&&e[t]instanceof Array){if(!this[t].equals(e[t]))return!1}else if(this[t]!=e[t])return!1;return!0},n.createInitialLayout=function(e,t){var r={sequence:"",name:"empty",positions:[],labelInterval:n.options.labelInterval,avoidOthers:!0,uids:[],circularizeExternal:!0};if(2==arguments.length)for(var o in t)r.hasOwnProperty(o)&&(r[o]=t[o]);console.log("options.uids:",r.uids);var i=new m(r.sequence,e,r.name);i.circularizeExternal=r.circularizeExternal;var s=i.recalculateElements();if(0===r.positions.length)if("naview"==n.options.layout){var a=(new N).naview_xy_coordinates(i.pairtable);r.positions=[];for(var l=0;l<a.nbase;l++)r.positions.push([a.x[l],a.y[l]])}else r.positions=v(s.pairtable);return s=s.elementsToJson().addUids(r.uids).addPositions("nucleotide",r.positions).addLabels(1,r.labelInterval).reinforceStems().reinforceLoops().connectFakeNodes().reassignLinkUids().breakNodesToFakeNodes()},n.addRNA=function(e,t){var r=n.createInitialLayout(e,t);if(1===arguments.length&&(t={}),"extraLinks"in t){var o=n.addExternalLinks(r,t.extraLinks);n.extraLinks=n.extraLinks.concat(o)}return"centerPos"in t?n.addRNAJSON(r,{centerPos:t.centerPos,centerView:!1}):"avoidOthers"in t?n.addRNAJSON(r,{avoidOthers:t.avoidOthers}):n.addRNAJSON(r,{centerView:t.centerView}),r},n.changeNode=function(e,t){var r=t.rna,o=p.pairtableToDotbracket(r.pairtable),i=r.getPositions("nucleotide"),s=r.seq,a=r.getUids(),l=t.num,c=o,d=s.slice(0,l-1)+e+s.slice(l);console.log("newSequence:",d),console.log("uids:",a),a.splice(l-1,1,u.a.nice());var h=i;delete n.rnas[r.uid];n.addRNA(c,{sequence:d,positions:h,uids:a,centerView:!1})},n.insertNodeBeforeOrAfter=function(e,t,r){var o=t.rna,i=p.pairtableToDotbracket(o.pairtable),s=o.getPositions("nucleotide"),a=o.seq,l=o.getUids(),c=t.num+r,d=i.slice(0,c)+"."+i.slice(c),h=a.slice(0,c)+e+a.slice(c);console.log("newSequence:",h),l.splice(c,0,u.a.nice()),s.splice(c,0,s[c-r-1]);var f=l,g=s;console.log("positions:",s),console.log("new node positions:",g),delete n.rnas[o.uid];n.addRNA(d,{sequence:h,positions:g,uids:f,centerView:!1})},n.deleteNode=function(e){console.log("deleting...",e);var t=e.rna,r=t.pairtable[e.num];0!=r&&(t.pairtable[e.num]=0,t.pairtable[r]=0);var o=p.pairtableToDotbracket(t.pairtable),i=t.getPositions("nucleotide"),s=t.seq,a=t.getUids(),l=o.slice(0,e.num-1)+o.slice(e.num),u=i.slice(0,e.num-1).concat(i.slice(e.num)),c=s.slice(0,e.num-1)+s.slice(e.num),d=a.slice(0,e.num-1).concat(a.slice(e.num));delete n.rnas[t.uid];n.addRNA(l,{sequence:c,positions:u,uids:d,centerView:!1});console.log("new dotbracket:",l)},n.addExternalLinks=function(e,t){for(var n=[],r=0;r<t.length;r++){var o={linkType:"external",value:1,uid:u.a.nice(),source:null,target:null};if("[object Array]"===Object.prototype.toString.call(t[r][0])){for(var i=0;i<e.nodes.length;i++)if("nucs"in e.nodes[i]&&e.nodes[i].nucs.equals(t[r][0])){o.source=e.nodes[i];break}}else for(i=0;i<e.nodes.length;i++)e.nodes[i].num==t[r][0]&&(o.source=e.nodes[i]);if("[object Array]"===Object.prototype.toString.call(t[r][1]))for(i=0;i<e.nodes.length;i++)"nucs"in e.nodes[i]&&e.nodes[i].nucs.equals(t[r][1])&&(o.target=e.nodes[i]);else for(i=0;i<e.nodes.length;i++)e.nodes[i].num==t[r][1]&&(o.target=e.nodes[i]);null!=o.source&&null!=o.target?n.push(o):console.log("ERROR: source or target of new link not found:",o,t[r])}return n},n.addRNAJSON=function(e,t){var r,o,i=t.avoidOthers,s=void 0!==i&&i,l=t.centerPos,u=void 0===l?null:l,c=t.centerView,d=void 0===c||c;if(console.log("centerView:",d),null!=u){var h=0,f=0,p=0;e.nodes.forEach(function(e){h+=e.x,f+=e.y,p+=1}),p>0&&e.nodes.forEach(function(e){e.x=e.x+u[0]-h/p,e.y=e.y+u[1]-f/p,e.px=e.x,e.py=e.y})}return s&&(r=n.graph.nodes.length>0?a.a.max(n.graph.nodes.map(function(e){return e.x})):0,o=a.a.min(e.nodes.map(function(e){return e.x})),e.nodes.forEach(function(e){e.x+=r-o+20,e.px+=r-o})),e.nodes.forEach(function(t){t.rna=e}),n.rnas[e.uid]=e,n.recalculateGraph(),n.update(),d&&n.centerView(),e},n.transitionRNA=function(e,t){var r=n.options.transitionDuration,o={uids:n.graph.nodes.filter(function(e){return"nucleotide"==e.nodeType}).map(function(e){return e.uid})},i=n.createInitialLayout(e,o),s=M.selectAll("g.gnode").data(i.nodes,F);0===r?s.attr("transform",function(e){return"translate("+[e.x,e.y]+")"}):s.transition().attr("transform",function(e){return"translate("+[e.x,e.y]+")"}).duration(r);var a=S.selectAll("line.link").data(i.links.filter(A),q),l=n.createNewNodes(s.enter()).attr("transform",function(e){return void 0!==e.x&&void 0!==e.y?"translate("+[0,0]+")":""});if(0===r?s.exit().remove():s.exit().transition().attr("transform",function(e){return void 0!==e.x&&void 0!==e.y?"translate("+[0,0]+")":""}),s.select("path").each(w),n.graph.nodes=s.data(),n.updateStyle(),n.centerView(r),a.exit().remove(),0===r){a.attr("x1",function(e){return e.source.x}).attr("y1",function(e){return e.source.y}).attr("x2",function(e){return e.target.x}).attr("y2",function(e){return e.target.y});n.createNewLinks(a.enter());n.graph.links=a.data(),n.updateStyle()}else a.transition().attr("x1",function(e){return e.source.x}).attr("y1",function(e){return e.source.y}).attr("x2",function(e){return e.target.x}).attr("y2",function(e){return e.target.y}).duration(r).call(function(e,t){0===e.size()&&setTimeout(t,r);var n=0;e.each(function(){++n}).each("end",function(){--n||t.apply(this,arguments)})},function(){n.createNewLinks(a.enter()),n.graph.links=a.data(),n.updateStyle(),void 0!==t&&t()});0===r?l.attr("transform",function(e){return void 0!==e.x&&void 0!==e.y?"translate("+[e.x,e.y]+")":""}):l.transition().attr("transform",function(e){return void 0!==e.x&&void 0!==e.y?"translate("+[e.x,e.y]+")":""})},n.recalculateGraph=function(){for(var e in n.graph.nodes=[],n.graph.links=[],n.rnas)n.graph.nodes=n.graph.nodes.concat(n.rnas[e].nodes),n.graph.links=n.graph.links.concat(n.rnas[e].links);for(var t={},r=0;r<n.graph.nodes.length;r++)t[n.graph.nodes[r].uid]=n.graph.nodes[r];for(n.graph.links.forEach(function(e){e.source=t[e.source.uid],e.target=t[e.target.uid]}),r=0;r<n.extraLinks.length;r++)if(n.extraLinks[r].target.uid in t){if(n.extraLinks[r].source=t[n.extraLinks[r].source.uid],n.extraLinks[r].target=t[n.extraLinks[r].target.uid],"intermolecule"==n.extraLinks[r].linkType)for(var o=n.graph.links.filter(function(e){return(e.source==n.extraLinks[r].source||e.source==n.extraLinks[r].target||e.target==n.extraLinks[r].source||e.target==n.extraLinks[r].source)&&"fake"==e.linkType}),i=0;i<o.length;i++){var s=n.graph.links.indexOf(o[i]);n.graph.links.splice(s,1)}k.links.push(n.extraLinks[r])}else console.log("not there:",n.extraLinks[r])},n.addNodes=function(e){e.links.forEach(function(t){"number"==typeof t.source&&(t.source=e.nodes[t.source]),"number"==typeof t.target&&(t.target=e.nodes[t.target])}),n.graph.nodes.length>0?(maxX=a.a.max(n.graph.nodes.map(function(e){return e.x})),maxY=a.a.max(n.graph.nodes.map(function(e){return e.y}))):(maxX=0,maxY=0),e.nodes.forEach(function(e){e.rna.uid in n.rnas||(n.rnas[e.rna.uid]=e.rna),e.x+=maxX,e.px+=maxX}),r=new m("",""),r.nodes=e.nodes,r.links=e.links,n.recalculateGraph(),n.update(),n.centerView()},n.addCustomColors=function(e){n.customColors=e},n.addCustomColorsText=function(e){var t=new g(e);n.customColors=t.colorsJson,n.changeColorScheme("custom")},n.clearNodes=function(){n.graph.nodes=[],n.graph.links=[],n.rnas={},n.extraLinks=[],n.update()},n.toJSON=function(){var e={rnas:n.rnas,extraLinks:n.extraLinks};return JSON.stringify(e,function(e,t){return"rna"==e?void 0:t},"\t")},n.fromJSON=function(e){var t,o;try{var i=JSON.parse(e);t=i.rnas,o=i.extraLinks}catch(e){throw e}for(var s in t)"rna"==t[s].type?(r=new m,r.seq=t[s].seq,r.dotbracket=t[s].dotbracket,r.circular=t[s].circular,r.pairtable=t[s].pairtable,r.uid=t[s].uid,r.structName=t[s].structName,r.nodes=t[s].nodes,r.links=t[s].links,r.rnaLength=t[s].rnaLength,r.elements=t[s].elements,r.nucsToNodes=t[s].nucsToNodes,r.pseudoknotPairs=t[s].pseudoknotPairs):(r=new ProteinGraph,r.size=t[s].size,r.nodes=t[s].nodes,r.uid=t[s].uid),n.addRNAJSON(r,!1);o.forEach(function(e){n.extraLinks.push(e)}),n.recalculateGraph(),n.update()},n.setSize=function(){if(null==n.options.initialSize){var t=a.a.select(e).node().offsetHeight,r=a.a.select(e).node().offsetWidth;n.options.svgW=r,n.options.svgH=t,y.range([0,r]).domain([0,r]),b.range([0,t]).domain([0,t]),n.zoomer.x(y).y(b),n.brusher.x(y).y(b),n.centerView(),n.options.resizeSvgOnResize&&_.attr("width",r).attr("height",t)}},n.setOutlineColor=function(e){M.selectAll("g.gnode").select("[node_type=nucleotide]").style("fill",e)},n.changeColorScheme=function(e){M.selectAll("[node_type=protein]").classed(i.a.protein,!0).attr("r",function(e){return e.radius});M.selectAll("g.gnode"),M.selectAll("g.gnode").selectAll("circle");var t=M.selectAll("g.gnode").select("[node_type=nucleotide]");if(n.colorScheme=e,"sequence"==e){var r=a.a.scale.ordinal().range(["#dbdb8d","#98df8a","#ff9896","#aec7e8","#aec7e8"]).domain(["A","C","G","U","T"]);t.style("fill",function(e){return r(e.name)})}else if("structure"==e){r=a.a.scale.category10().domain(["s","m","i","e","t","h","x"]).range(["lightgreen","#ff9896","#dbdb8d","lightsalmon","lightcyan","lightblue","transparent"]);t.style("fill",function(e){return r(e.elemType)})}else if("positions"==e)t.style("fill",function(e){return a.a.scale.linear().range(["#98df8a","#dbdb8d","#ff9896"]).interpolate(a.a.interpolateLab).domain([1,1+(e.rna.rnaLength-1)/2,e.rna.rnaLength])(e.num)});else if("custom"==e){if(void 0!==n.customColors&&"domain"in n.customColors&&"range"in n.customColors)r=a.a.scale.linear().interpolate(a.a.interpolateLab).domain(n.customColors.domain).range(n.customColors.range);t.style("fill",function(e){return void 0!==n.customColors&&n.customColors.hasOwnProperty("colorValues")?n.customColors.colorValues.hasOwnProperty(e.structName)&&n.customColors.colorValues[e.structName].hasOwnProperty(e.num)?E(n.customColors.colorValues[e.structName],e,r):n.customColors.colorValues.hasOwnProperty("")?E(n.customColors.colorValues[""],e,r):"white":"white"})}},window.addEventListener("resize",n.setSize,!1),n.zoomer=a.a.behavior.zoom().scaleExtent([.1,10]).x(y).y(b).on("zoomstart",function(){var e=M.selectAll("g.gnode").selectAll(".outlineNode");e.each(function(e){e.selected=!1,e.previouslySelected=!1}),e.classed(i.a.selected,!1)}).on("zoom",function(){T.attr("transform","translate("+a.a.event.translate+") scale("+a.a.event.scale+")")}),a.a.select(e).select("svg").remove();var _=a.a.select(e).attr("tabindex",1).on("keydown.brush",X).on("keyup.brush",D).each(function(){this.focus()}).append("svg:svg").attr("width",n.options.svgW).attr("height",n.options.svgH).attr("class","fornacPlot");n.options.svg=_;var L=_.append("svg:g").on("mousemove",function(){if(c){var e=a.a.mouse(T.node());R.attr("x1",c.x).attr("y1",c.y).attr("x2",e[0]).attr("y2",e[1])}}).on("mousedown",function(){}).on("mouseup",function(){c&&(f||R.attr("class",i.a.dragLineHidden)),C()});n.options.allowPanningAndZooming&&L.call(n.zoomer),n.options.editable&&L.on("contextmenu",n.backgroundContextMenu);var P=L.append("g").datum(function(){return{selected:!1,previouslySelected:!1}}).attr("class",i.a.brush),T=L.append("svg:g"),S=T.append("svg:g"),M=T.append("svg:g");n.brusher=a.a.svg.brush().x(y).y(b).on("brushstart",function(e){M.selectAll("g.gnode").selectAll(".outlineNode").each(function(e){e.previouslySelected=I&&e.selected})}).on("brush",function(){var e=M.selectAll("g.gnode").selectAll(".outlineNode"),t=a.a.event.target.extent();e.classed(i.a.selected,function(e){return e.selected=n.options.applyForce&&e.previouslySelected^(t[0][0]<=e.x&&e.x<t[1][0]&&t[0][1]<=e.y&&e.y<t[1][1])})}).on("brushend",function(){a.a.event.target.clear(),a.a.select(this).call(a.a.event.target)}),P.call(n.brusher).on("mousedown.brush",null).on("touchstart.brush",null).on("touchmove.brush",null).on("touchend.brush",null),P.select(".background").style("cursor","auto"),n.getBoundingBoxTransform=function(){if(0===n.graph.nodes.length)return{translate:[0,0],scale:1};var e=a.a.min(n.graph.nodes.map(function(e){return e.x})),t=a.a.min(n.graph.nodes.map(function(e){return e.y})),r=a.a.max(n.graph.nodes.map(function(e){return e.x})),o=a.a.max(n.graph.nodes.map(function(e){return e.y})),i=a.a.max(n.graph.nodes.map(function(e){return e.radius})),s=r-e,l=o-t,u=n.options.svgW/(s+1),c=n.options.svgH/(l+1),d=.8*Math.min(u,c,n.options.maxNodeRadius/i),h=s*d,f=l*d;return{translate:[-e*d+(n.options.svgW-h)/2,-t*d+(n.options.svgH-f)/2],scale:d}},n.centerView=function(e){0===arguments.length&&(e=0);var t=n.getBoundingBoxTransform();null!==t&&(T.transition().attr("transform","translate("+t.translate+") scale("+t.scale+")").duration(e),n.zoomer.translate(t.translate),n.zoomer.scale(t.scale))},n.force=a.a.layout.force().charge(function(e){return"middle"==e.nodeType?n.options.middleCharge:n.options.otherCharge}).friction(n.options.friction).linkDistance(function(e){return n.options.linkDistanceMultiplier*e.value}).linkStrength(function(e){return e.linkType in n.linkStrengths?n.linkStrengths[e.linkType]:n.linkStrengths.other}).gravity(0).nodes(n.graph.nodes).links(n.graph.links).chargeDistance(n.options.chargeDistance).size([n.options.svgW,n.options.svgH]);var R=T.append("line").attr("class",i.a.dragLine).attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",0);function C(){c=null,d=null,null}var B=!1,I=!1;function O(e){var t=M.selectAll("g.gnode");return t.filter(function(e){return e.selected})}function Y(e){var t=e.radius+16,n=e.x-t,r=e.x+t,o=e.y-t,i=e.y+t;return function(t,s,a,l,u){if(t.point&&t.point!==e){var c=e.x-t.point.x,d=e.y-t.point.y,h=Math.sqrt(c*c+d*d),f=e.radius+t.point.radius;h<f&&(h=(h-f)/h*.1,e.x-=c*=h,e.y-=d*=h,t.point.x+=c,t.point.y+=d)}return s>r||l<n||a>i||u<o}}n.resumeForce=function(){n.animation&&n.force.resume()};var U=a.a.behavior.drag().on("dragstart",function(e){a.a.event.sourceEvent.stopPropagation(),e.selected||I||M.selectAll("g.gnode").selectAll(".outlineNode").classed(i.a.selected,function(e){return e.selected=n.options.applyForce&&(e.previouslySelected=!1)}),a.a.select(this).select(".outlineNode").classed(i.a.selected,function(t){return e.previouslySelected=e.selected,e.selected=n.options.applyForce&&!0}),O().each(function(e){e.fixed|=2})}).on("drag",function(e){O().each(function(e){e.x+=a.a.event.dx,e.y+=a.a.event.dy,e.px+=a.a.event.dx,e.py+=a.a.event.dy}),n.resumeForce(),a.a.event.sourceEvent.preventDefault()}).on("dragend",function(e){O().each(function(e){e.fixed&=-7})});function X(){if(!n.deaf&&!B){switch(a.a.event.keyCode){case 68:console.log("dotbracket:",n.getStructuresDotBracket());break;case 16:B=!0;break;case 17:I=!0;break;case 67:n.centerView()}(B||I)&&(L.call(n.zoomer).on("mousedown.zoom",null).on("touchstart.zoom",null).on("touchmove.zoom",null).on("touchend.zoom",null),T.selectAll("g.gnode").on("mousedown.drag",null)),I&&(P.select(".background").style("cursor","crosshair"),P.call(n.brusher))}}function D(){B=!1,I=!1,P.call(n.brusher).on("mousedown.brush",null).on("touchstart.brush",null).on("touchmove.brush",null).on("touchend.brush",null),P.select(".background").style("cursor","auto"),L.call(n.zoomer),T.selectAll("g.gnode").call(U)}a.a.select(e).on("keydown",X).on("keyup",D).on("contextmenu",function(){a.a.event.preventDefault()});var q=function(e){return e.uid},F=function(e){return e.uid},z=function(e){var t=e.getPositions("nucleotide"),r=e.getPositions("label"),o=e.getUids();e.recalculateElements().elementsToJson().addPseudoknots().addPositions("nucleotide",t).addUids(o).addLabels(1,n.options.labelInterval).addPositions("label",r).reinforceStems().reinforceLoops().updateLinkUids()},V=function(e){var t=n.graph.links.indexOf(e);if(console.log("removing link:",t),t>-1){if(e.source.rna==e.target.rna){if("backbone"==e.linkType)return console.log("trying to remove a backbone link",e.source.num,e.target.num),void function(e){if(e.target.num-e.source.num==1){for(var t=e.target.rna,r=[],o=0;o<t.links.length;o++){var i=t.links[o];"basepair"==i.linkType&&i.source.num<=e.source.num&&i.target.num>=e.target.num&&(console.log("crossing basepair",i),r.push(i))}console.log("toRemove:",r);for(var s=0;s<r.length;s++)t.pairtable[r[s].source.num]=0,t.pairtable[r[s].target.num]=0,r[s].from=r[s].source.num,r[s].to=r[s].target.num-e.source.num;t.seq;var a=t.seq.slice(0,e.source.num),l=t.seq.slice(e.source.num),c=p.pairtableToDotbracket(t.pairtable),d=c.slice(0,e.source.num),h=c.slice(e.source.num),f=t.getPositions("nucleotide"),g=t.getUids(),y=f.slice(0,e.source.num),m=f.slice(e.source.num),v=g.slice(0,e.source.num),b=g.slice(e.source.num);console.log("positions1:",y),console.log("positions2:",m),delete n.rnas[t.uid];for(var k=n.addRNA(d,{sequence:a,positions:y,uids:v}),x=n.addRNA(h,{sequence:l,positions:m,uids:b}),w=0;w<r.length;w++)console.log("rna1:",k),console.log("rna2:",x),console.log("toRemove[i]",r[w]),n.extraLinks.push({source:k.nodes[r[w].from-1],target:x.nodes[r[w].to-1],value:1,uid:u.a.nice(),linkType:"intermolecule"}),n.recalculateGraph(),n.update();console.log("self.extraLinks:",n.extraLinks)}else console.log("ERROR: non adjacent nodes. Target:",e.target,"Source:",e.source,"Link:",e)}(e);var r=e.source.rna;r.addPseudoknots(),r.pairtable[e.source.num]=0,r.pairtable[e.target.num]=0,z(r)}else{var o=n.extraLinks.indexOf(e);n.extraLinks.splice(o,1)}n.recalculateGraph()}n.update()},j=function(e){if(B){console.log("d.linkType:",e.linkType),e.linkType in{fake:!0,fake_fake:!0,label_link:!0}||V(e)}};n.getStructuresDotBracket=function(){console.log("self.rnas:",n.rnas);var e=[],t=1,r={},o=[],i=[];for(var s in n.rnas){for(var a=n.rnas[s],l=0;l<a.nodes.length;l++){var u=a.nodes[l];"nucleotide"==u.nodeType&&(console.log("node:",u),r[u.uid]=t,t+=1,e.push(u.name))}o.push(t)}i=[t-1];for(var c=0;c<t;c++)i.push(0);for(var d in n.rnas)for(var h=n.rnas[d],f=0;f<h.links.length;f++){var g=h.links[f];if("basepair"==g.linkType){var y=r[g.source.uid],m=r[g.target.uid];i[y]=m,i[m]=y}}for(var v=0;v<n.extraLinks.length;v++){var b=n.extraLinks[v],k=r[b.source.uid],x=r[b.target.uid];i[k]=x,i[x]=k}for(var w=p.pairtableToDotbracket(i).split(""),A=0;A<o.length-1;A++)console.log("breaks[i]:",o[A]),e.splice(o[A]+A-1,0,"&"),w.splice(o[A]+A-1,0,"&");return console.log("sequence:",e,e.join("")),console.log("structure:",w,w.join("")),[e.join(""),w.join("")]},n.addBackBoneLink=function(e){for(var t=e.source.rna,r=e.target.rna,o=p.pairtableToDotbracket(t.pairtable),i=p.pairtableToDotbracket(r.pairtable),s=e.source.rna.seq,a=e.target.rna.seq,l=t.getPositions("nucleotide"),c=r.getPositions("nucleotide"),d=o+i,h=s+a,f=l.concat(c),g=[],y={},m=0;m<n.extraLinks.length;m++)console.log("self.extraLinks[i]",n.extraLinks[m]),console.log("rna1:",t),console.log("rna2:",r),n.extraLinks[m].source.rna==t?n.extraLinks[m].target.rna==r||(g.push({source:n.extraLinks[m].target,target:n.extraLinks[m].source.num}),y[n.extraLinks[m].uid]=!0):n.extraLinks[m].source.rna==r&&(n.extraLinks[m].target.rna==t||(g.push({source:n.extraLinks[m].target,target:n.extraLinks[m].source.num+o.length}),y[n.extraLinks[m].uid]=!0)),n.extraLinks[m].target.rna==t?n.extraLinks[m].source.rna==r||(g.push({source:n.extraLinks[m].source,target:n.extraLinks[m].target.num}),y[n.extraLinks[m].uid]=!0):n.extraLinks[m].target.rna==r&&n.extraLinks[m].source.rna==t&&(g.push({source:n.extraLinks[m].source,target:n.extraLinks[m].target.num+o.length}),y[n.extraLinks[m].uid]=!0);n.extraLinks=n.extraLinks.filter(function(e){return!(e.uid in y)}),delete n.rnas[t.uid],delete n.rnas[r.uid];var v=null;v=n.options.applyForce?n.addRNA(d,{sequence:h,positions:f,centerView:!1}):n.addRNA(d,{sequence:h,centerView:!1});for(var b=0;b<g.length;b++)n.extraLinks.push({source:g[b].source,target:v.nodes[g[b].target-1],value:1,uid:u.a.nice(),linkType:"intermolecule"});n.recalculateGraph(),n.update(),console.log("self.extraLinks:",n.extraLinks)},n.addLink=function(e){if(console.log("adding new link"),e.source.rna==e.target.rna){var t=e.source.rna;t.pairtable[e.source.num]=e.target.num,t.pairtable[e.target.num]=e.source.num,z(t)}else console.log("intermolecule"),e.linkType="intermolecule",n.extraLinks.push(e);n.recalculateGraph(),n.update()};var G=function(e){if(!a.a.event.defaultPrevented){if(!I)M.selectAll("g.gnode").selectAll(".outlineNode").classed(i.a.selected,function(e){return e.selected=n.options.applyForce&&(e.previouslySelected=!1)});a.a.select(this).select("circle").classed(i.a.selected,e.selected=n.options.applyForce&&!e.previouslySelected),a.a.event.stopPropagation()}},H=function(e,t){var r=!0;if(c){if("middle"==(d=e).nodeType||"middle"==c.nodeType||"label"==d.nodeType||"label"==c.nodeType)return;if(d==c)return void C();for(var o={source:c,target:d,linkType:"basepair",value:1,uid:u.a.nice()},s=0;s<n.graph.links.length;s++)if(n.graph.links[s].source!=c&&n.graph.links[s].target!=c&&n.graph.links[s].source!=d&&n.graph.links[s].target!=d||"basepair"!=n.graph.links[s].linkType&&"pseudoknot"!=n.graph.links[s].linkType&&"intermolecule"!=n.graph.links[s].linkType||(console.log("no basepair possible"),r=!1),(n.graph.links[s].source==d&&n.graph.links[s].target==c||n.graph.links[s].source==c&&n.graph.links[s].target==d)&&"backbone"==n.graph.links[s].linkType)return;if(o.source.rna!=o.target.rna)if(1==o.source.num&&o.target.num==o.target.rna.rnaLength||1==o.target.num&&o.source.num==o.source.rna.rnaLength){var a=[{title:"Backbone Link",action:function(e,t,r){f=!1,console.log("Item #1 clicked!"),console.log("The data for this circle is: "+t),R.attr("class",i.a.dragLineHidden),n.addBackBoneLink(o)},disabled:!1},{title:"Basepair Link",action:function(e,t,r){f=!1,console.log("You have clicked the second item!"),console.log("The data for this circle is: "+t),R.attr("class",i.a.dragLineHidden),n.addLink(o)}}];f=!0;var l=h(a);console.log("newLinkMenu"),l.apply(this,[e,t,!0,function(){R.attr("class",i.a.dragLineHidden)}])}else r&&n.addLink(o);else r&&n.addLink(o)}},J=function(e){e.selected||I||M.selectAll("g.gnode").selectAll(".outlineNode").classed(i.a.selected,function(e){return e.selected=e.previouslySelected=!1});a.a.select(this).classed(i.a.selected,function(t){return e.previouslySelected=e.selected,e.selected=n.options.applyForce&&!0}),B&&(c=e,R.attr("class",i.a.dragLine).attr("x1",c.x).attr("y1",c.y).attr("x2",c.x).attr("y2",c.y))};n.startAnimation=function(){n.animation=!0,T.selectAll("g.gnode").call(U),n.force.start()},n.stopAnimation=function(){n.animation=!1,T.selectAll("g.gnode").on("mousedown.drag",null),n.force.stop()},n.setFriction=function(e){n.force.friction(e),n.resumeForce()},n.setCharge=function(e){n.force.charge(e),n.resumeForce()},n.setGravity=function(e){n.force.gravity(e),n.resumeForce()},n.setPseudoknotStrength=function(e){n.linkStrengths.pseudoknot=e,n.update()},n.displayBackground=function(e){n.displayParameters.displayBackground=e,n.updateStyle()},n.displayNumbering=function(e){n.displayParameters.displayNumbering=e,n.updateStyle()},n.displayNodeOutline=function(e){n.displayParameters.displayNodeOutline=e,n.updateStyle()},n.displayNodeLabel=function(e){n.displayParameters.displayNodeLabel=e,n.updateStyle()},n.displayLinks=function(e){n.displayParameters.displayLinks=e,n.updateStyle()},n.displayPseudoknotLinks=function(e){n.displayParameters.displayPseudoknotLinks=e,n.updateStyle()},n.displayProteinLinks=function(e){n.displayParameters.displayProteinLinks=e,n.updateStyle()},n.updateStyle=function(){M.selectAll("[node_type=label]").classed(i.a.transparent,!n.displayParameters.displayNumbering),M.selectAll("[label_type=label]").classed(i.a.transparent,!n.displayParameters.displayNumbering),S.selectAll("[linkType=label_link]").classed(i.a.transparent,!n.displayParameters.displayNumbering),_.selectAll("circle").classed(i.a.hiddenOutline,!n.displayParameters.displayNodeOutline),M.selectAll("[label_type=nucleotide]").classed(i.a.transparent,!n.displayParameters.displayNodeLabel),_.selectAll("[link_type=real],[link_type=basepair],[link_type=backbone],[link_type=pseudoknot],[link_type=protein_chain],[link_type=chain_chain],[link_type=external]").classed(i.a.transparent,!n.displayParameters.displayLinks),_.selectAll("[link_type=pseudoknot]").classed(i.a.transparent,!n.displayParameters.displayPseudoknotLinks),_.selectAll("[link_type=protein_chain]").classed(i.a.transparent,!n.displayParameters.displayProteinLinks),S.selectAll("[link_type=fake]").classed(i.a.transparent,!n.options.displayAllLinks),S.selectAll("[link_type=fake_fake]").classed(i.a.transparent,!n.options.displayAllLinks)},n.createNewLinks=function(e){var t=e.append("svg:line");return t.append("svg:title").text(q),t.classed("link",!0).classed(i.a.link,!0).attr("x1",function(e){return e.source.x}).attr("y1",function(e){return e.source.y}).attr("x2",function(e){return e.target.x}).attr("y2",function(e){return e.target.y}).attr("link_type",function(e){return e.linkType}).attr("pointer-events",function(e){return"fake"==e.linkType?"none":"all"}),t},n.createNewNodes=function(e){(e=e.append("g").classed(i.a.noselect,!0).classed("gnode",!0).attr("struct_name",function(e){return e.structName}).attr("transform",function(e){return void 0!==e.x&&void 0!==e.y?"translate("+[e.x,e.y]+")":""}).each(function(e){e.selected=e.previouslySelected=!1})).call(U).on("mousedown",J).on("mousedrag",function(e){}).on("mouseup",H).attr("num",function(e){return"n"+e.num}).attr("rnum",function(e){return"n"+(e.rna.rnaLength-e.num+1)}).on("click",G).on("contextmenu",n.nodeContextMenu).transition().duration(750).ease("elastic");var t=e.filter(function(e){return"label"==e.nodeType||"protein"==e.nodeType}),r=e.filter(function(e){return"nucleotide"==e.nodeType});return t.append("svg:circle").attr("class","outlineNode").classed(i.a.outlineNode,!0).attr("r",function(e){return e.radius+1}),r.append("svg:circle").attr("class","outlineNode").classed(i.a.outlineNode,!0).attr("r",function(e){return e.radius+1}),t.append("svg:circle").attr("class",i.a.node).classed(i.a.label,function(e){return"label"==e.nodeType}).attr("r",function(e){return"middle"==e.nodeType?0:e.radius}).attr("node_type",function(e){return e.nodeType}).attr("node_num",function(e){return e.num}),r.append("svg:circle").attr("class",i.a.node).attr("node_type",function(e){return e.nodeType}).attr("node_num",function(e){return e.num}).attr("r",function(e){return e.radius}).append("svg:title").text(function(e){return"nucleotide"==e.nodeType?e.structName+":"+e.num:""}),r.append("svg:path").attr("class",i.a.node).attr("node_type",function(e){return e.nodeType}).attr("node_num",function(e){return e.num}).append("svg:title").text(function(e){return"nucleotide"==e.nodeType?e.structName+":"+e.num:""}),e.append("text").text(function(e){return e.name}).attr("class",i.a.nodeLabel).attr("label_type",function(e){return e.nodeType}).append("svg:title").text(function(e){return"nucleotide"==e.nodeType?e.structName+":"+e.num:""}),e};n.update=function(){n.force.nodes(n.graph.nodes).links(n.graph.links),n.animation&&n.force.start();var e=S.selectAll("line.link").data(n.graph.links.filter(A),q);e.attr("class","").classed("link",!0).classed(i.a.link,!0).attr("link_type",function(e){return e.linkType});var t=e.enter();n.createNewLinks(t),e.exit().remove();a.a.scale.category10().domain([0,1,2,3,4,5,6,7,8,9]);var r=M.selectAll("g.gnode").data(n.graph.nodes,F),o=r.enter();n.createNewNodes(o),r.exit().remove();var s,l=n.graph.nodes.filter(function(e){return"nucleotide"==e.nodeType||"label"==e.nodeType});s=n.displayFakeLinks?e:S.selectAll("[link_type=real],[link_type=pseudoknot],[link_type=protein_chain],[link_type=chain_chain],[link_type=label_link],[link_type=backbone],[link_type=basepair],[link_type=intermolecule],[link_type=external]"),r.selectAll("path").each(w),s.on("click",j),n.force.on("tick",function(){for(var e=a.a.geom.quadtree(l),t=0,n=l.length;++t<n;)e.visit(Y(l[t]));s.attr("x1",function(e){return e.source.x}).attr("y1",function(e){return e.source.y}).attr("x2",function(e){return e.target.x}).attr("y2",function(e){return e.target.y}),r.attr("transform",function(e){return"translate("+[e.x,e.y]+")"}),r.select("path").each(w)}),n.force.on("end",function(){for(var e in r.selectAll("[node_type=nucleotide]").filter(function(e,t){return 0==t}).each(function(e,t){}),n.rnas)for(var t=1;t<n.rnas[e].pairtable[0];t++);}),n.changeColorScheme(n.colorScheme),n.animation&&n.force.start(),n.updateStyle()},n.setSize()}function L(){var e,t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r={width:300,height:300,nucleotideRadius:5,rnaEdgePadding:1,labelInterval:10,showNucleotideLabels:!0,startNucleotideNumber:1,bundleExternalLinks:!1,rnaLayout:"simple",namePosition:"0 0"};r=Object.assign(r,n);function o(n){n.each(function(n){var o=d3.select(this).append("g").classed("rnaplot",!0),s=new m(n.sequence,n.structure,n.name,r.startNucleotideNumber).recalculateElements().elementsToJson().addName(n.name);n.rnaGraph=s;var a=[];if("naview"===r.rnaLayout)for(var l=(new N).naview_xy_coordinates(s.pairtable),u=0;u<l.nbase;u++)a.push([l.x[u],l.y[u]]);else a=v(s.pairtable);s.addPositions("nucleotide",a).addLabels(r.startNucleotideNumber,r.labelInterval);var c=function(n,o){var i=d3.extent(n),s=d3.extent(o);i[0]-=r.nucleotideRadius+r.rnaEdgePadding,s[0]-=r.nucleotideRadius+r.rnaEdgePadding,i[1]+=r.nucleotideRadius+r.rnaEdgePadding,s[1]+=r.nucleotideRadius+r.rnaEdgePadding;var a,l=i[1]-i[0],u=s[1]-s[0];function c(e,t,n){var r=(e.range()[1]-e.range()[0])/(e.domain()[1]-e.domain()[0]),o=(t[1]-t[0])*r,i=(n[1]-n[0]-o)/2;return{scaleFactor:r,scale:d3.scale.linear().domain(t).range([n[0]+i,n[1]-i])}}return l-r.width>u-r.height?(a=c(e=d3.scale.linear().domain(i).range([0,r.width]),s,[0,r.height]),t=a.scale):(a=c(t=d3.scale.linear().domain(s).range([0,r.height]),i,[0,r.width]),e=a.scale),e.range()[0],e.domain()[0],t.range()[0],t.domain()[0],"translate("+-(e.domain()[0]*a.scaleFactor-e.range()[0])+","+-(t.domain()[0]*a.scaleFactor-t.range()[0])+")scale("+a.scaleFactor+")"}(s.nodes.map(function(e){return e.x}),s.nodes.map(function(e){return e.y}));o.attr("transform",c);var d=s.nodes.filter(function(e){return"nucleotide"==e.nodeType}),h=s.nodes.filter(function(e){return"label"==e.nodeType}),f=s.links;!function(e,t){t=t.filter(function(e){return null!==e.source&&null!==e.target}),e.selectAll(".link").data(t).enter().append("svg:line").attr("x1",function(e){return e.source.x}).attr("x2",function(e){return e.target.x}).attr("y1",function(e){return e.source.y}).attr("y2",function(e){return e.target.y}).attr("link-type",function(e){return e.linkType}).attr("extra-link-type",function(e){return e.extraLinkType}).classed("link",!0).classed(i.a.link,!0)}(o,f),function(e,t){var n=e.selectAll(".node").data(t).enter().append("svg:g").attr("transform",function(e){return"translate("+e.x+","+e.y+")"});n.append("svg:circle").attr("nucleotide",function(e){if(e.name)return e.name.toLowerCase()}).attr("r",r.nucleotideRadius).classed("node",!0).classed(i.a.node,!0),r.showNucleotideLabels&&n.append("svg:text").text(function(e){return e.name}).classed(i.a.nodeLabel,!0).append("svg:title").text(function(e){return e.struct_name+":"+e.num})}(o,d),function(e,t){var n=e.selectAll(".rnaLabel").data(t).enter().append("svg:g").attr("transform",function(e){return"translate("+e.x+","+e.y+")"});n.append("svg:circle").attr("r",r.nucleotideRadius).classed("node",!0).classed(i.a.node,!0).classed(i.a.nodeLabel,!0),n.append("svg:text").text(function(e){return e.name}).attr("text-anchor","middle").attr("font-weight","bold").attr("dominant-baseline","central").classed(i.a.nodeLabel,!0)}(o,h),function(e,t){var n=e.append("svg:text").classed(i.a.rnaName,!0).text(t),o=r.namePosition.split(" ",2),s=[],a=n.node().getBBox(),l=[a.width,a.height],u=[r.width,r.height];for(var c in[0,1])switch(o[c]){case"0":s[c]=l[c]/2;break;case"1":s[c]=u[c]-l[c]/2;break;case"0.5":s[c]=u[c]/2}n.attr("x",s[0]).attr("y",s[1])}(d3.select(this),n.name),r.bundleExternalLinks&&function(e,t){var n={},r=[];t=t.filter(function(e){return"correct"==e.linkType||"incorrect"==e.linkType||"extra"==e.linkType}),e.selectAll("[link-type=extra]").remove();for(var o=0;o<t.length;o++)null!==t[o].source&&null!==t[o].target&&(n[t[o].source.uid]=t[o].source,n[t[o].target.uid]=t[o].target,r.push({source:t[o].source.uid,target:t[o].target.uid,linkType:t[o].linkType,extraLinkType:t[o].extraLinkType}));var i=d3.ForceEdgeBundling().nodes(n).edges(r).compatibility_threshold(.8).step_size(.2)(),s=d3.svg.line().x(function(e){return e.x}).y(function(e){return e.y}).interpolate("linear");for(o=0;o<i.length;o++){var a=i[o];e.append("path").attr("d",s(a)).style("fill","none").attr("link-type",function(e){return r[o].linkType}).attr("extra-link-type",function(e){return r[o].extraLinkType}).style("stroke-opacity",.4)}}(o,f)})}return o.width=function(e){return arguments.length?(r.width=e,o):r.width},o.height=function(e){return arguments.length?(r.height=e,o):r.height},o.showNucleotideLabels=function(e){return arguments.length?(r.showNucleotideLabels=e,o):r.showNucleotideLabels},o.rnaEdgePadding=function(e){return arguments.length?(r.rnaEdgePadding=e,o):r.rnaEdgePadding},o.nucleotideRadius=function(e){return arguments.length?(r.nucleotideRadius=e,o):r.nucleotideRadius},o.labelInterval=function(e){return arguments.length?(r.labelInterval=e,o):r.labelInterval},o.showNucleotideLabels=function(e){return arguments.length?(r.showNucleotideLabels=e,o):r.showNucleotideLabels},o.startNucleotideNumber=function(e){return arguments.length?(r.startNucleotideNumber=e,o):r.startNucleotideNumber},o.bundleExternalLinks=function(e){return arguments.length?(r.bundleExternalLinks=e,o):r.bundleExternalLinks},o.rnaLayout=function(e){return arguments.length?(r.rnaLayout=e,o):r.rnaLayout},o.namePosition=function(e){return arguments.length?(r.namePosition=e,o):r.namePosition},o}function P(e){var t={width:300,height:300,nucleotideRadius:5,rnaEdgePadding:1,labelInterval:10,showNucleotideLabels:!0,startNucleotideNumber:1,bundleExternalLinks:!1,rnaLayout:"simple",namePosition:"0 0"};t=Object.assign(t,e);function n(e){e.each(function(e){d3.select(this).attr("transform",function(e){return"translate("+e.x+","+e.y+")"}).append("rect").attr("width",function(e){return Math.max(0,e.dx)}).attr("height",function(e){return Math.max(0,e.dy)});var n=L(t).width(Math.max(0,e.dx)).height(Math.max(0,e.dy));"structure"in e&&d3.select(this).call(n)})}var r=function(e){e.each(function(e){console.log("data:",e);var r=d3.layout.treemap().size([t.width,t.height]).sticky(!1).value(function(e){return e.size});d3.select(this).append("g").classed("rnatreemap",!0).datum(e).selectAll(".treemapnode").data(r.nodes).enter().append("g").classed("treemapnode",!0).call(n)})};return r.width=function(e){return arguments.length?(t.width=e,r):t.width},r.height=function(e){return arguments.length?(t.height=e,r):t.height},r.showNucleotideLabels=function(e){return arguments.length?(t.showNucleotideLabels=e,r):t.showNucleotideLabels},r.rnaEdgePadding=function(e){return arguments.length?(t.rnaEdgePadding=e,r):t.rnaEdgePadding},r.nucleotideRadius=function(e){return arguments.length?(t.nucleotideRadius=e,r):t.nucleotideRadius},r.labelInterval=function(e){return arguments.length?(t.labelInterval=e,r):t.labelInterval},r.showNucleotideLabels=function(e){return arguments.length?(t.showNucleotideLabels=e,r):t.showNucleotideLabels},r.startNucleotideNumber=function(e){return arguments.length?(t.startNucleotideNumber=e,r):t.startNucleotideNumber},r.bundleExternalLinks=function(e){return arguments.length?(t.bundleExternalLinks=e,r):t.bundleExternalLinks},r.rnaLayout=function(e){return arguments.length?(t.rnaLayout=e,r):t.rnaLayout},r.namePosition=function(e){return arguments.length?(t.namePosition=e,r):t.namePosition},r.zoom=function(e){return arguments.length?(t.zoom=e,r):t.zoom},r}N.prototype.naview_xy_coordinates=function(e){var t,n=[],r=[];if(0===e.length||0===e[0])return 0;this.nbase=e[0],this.bases=[];for(var o=0;o<this.nbase+1;o++)this.bases.push(new w);this.regions=[];for(o=0;o<this.nbase+1;o++)this.regions.push(new x.a);this.read_in_bases(e),this.rlphead=null,this.find_regions(),this.loop_count=0,this.loops=[];for(o=0;o<this.nbase+1;o++)this.loops.push(new A.a);for(this.construct_loop(0),this.find_central_loop(),this.traverse_loop(this.root,null),t=0;t<this.nbase;t++)n.push(100+this.BACKBONE_DISTANCE*this.bases[t+1].getX()),r.push(100+this.BACKBONE_DISTANCE*this.bases[t+1].getY());return{nbase:this.nbase,x:n,y:r}},N.prototype.read_in_bases=function(e){var t=null,n=null;for(this.bases.push(new w),this.bases[0].setMate(0),this.bases[0].setExtracted(!1),this.bases[0].setX(this.ANUM),this.bases[0].setY(this.ANUM),n=0,t=1;t<=this.nbase;t++)this.bases.push(new w),this.bases[t].setExtracted(!1),this.bases[t].setX(this.ANUM),this.bases[t].setY(this.ANUM),this.bases[t].setMate(e[t]),e[t]>t&&n++;0==n&&(this.bases[1].setMate(this.nbase),this.bases[this.nbase].setMate(1))},N.prototype.find_regions=function(){var e,t=null,n=null;e=this.nbase+1;var r=[];for(t=0;t<e;t++)r.push(!1);for(this.nregion=0,t=0;t<=this.nbase;t++)if(0!=(n=this.bases[t].getMate())&&!r[t]){for(this.regions[this.nregion].setStart1(t),this.regions[this.nregion].setEnd2(n),r[t]=!0,r[n]=!0,this.bases[t].setRegion(this.regions[this.nregion]),this.bases[n].setRegion(this.regions[this.nregion]),t++,n--;t<n&&this.bases[t].getMate()==n;t++,n--)r[n]=!0,r[t]=!0,this.bases[t].setRegion(this.regions[this.nregion]),this.bases[n].setRegion(this.regions[this.nregion]);this.regions[this.nregion].setEnd1(--t),this.regions[this.nregion].setStart2(n+1),this.nregion++}},N.prototype.construct_loop=function(e){var t=null,n=null,r=new A.a,o=new A.a,i=new k.Connection,s=new x.a,a=new b;for((r=this.loops[this.loop_count++]).setNconnection(0),r.setDepth(0),r.setNumber(this.loop_count),r.setRadius(0),a=this.rlphead;null!=a;a=a.getNext())a.getLoopnumber()==this.loop_count&&r.setRadius(a.getRadius());t=e;do{0!=(n=this.bases[t].getMate())&&(s=this.bases[t].getRegion(),this.bases[s.getStart1()].isExtracted()||(t==s.getStart1()?(this.bases[s.getStart1()].setExtracted(!0),this.bases[s.getEnd1()].setExtracted(!0),this.bases[s.getStart2()].setExtracted(!0),this.bases[s.getEnd2()].setExtracted(!0),o=this.construct_loop(s.getEnd1()<this.nbase?s.getEnd1()+1:0)):t==s.getStart2()?(this.bases[s.getStart2()].setExtracted(!0),this.bases[s.getEnd2()].setExtracted(!0),this.bases[s.getStart1()].setExtracted(!0),this.bases[s.getEnd1()].setExtracted(!0),o=this.construct_loop(s.getEnd2()<this.nbase?s.getEnd2()+1:0)):console.log("Something went terribly wrong ...."),r.setNconnection(r.getNconnection()+1),i=new k.Connection,r.setConnection(r.getNconnection()-1,i),r.setConnection(r.getNconnection(),null),i.setLoop(o),i.setRegion(s),t==s.getStart1()?(i.setStart(s.getStart1()),i.setEnd(s.getEnd2())):(i.setStart(s.getStart2()),i.setEnd(s.getEnd1())),i.setExtruded(!1),i.setBroken(!1),o.setNconnection(o.getNconnection()+1),i=new k.Connection,o.setConnection(o.getNconnection()-1,i),o.setConnection(o.getNconnection(),null),i.setLoop(r),i.setRegion(s),t==s.getStart1()?(i.setStart(s.getStart2()),i.setEnd(s.getEnd1())):(i.setStart(s.getStart1()),i.setEnd(s.getEnd2())),i.setExtruded(!1),i.setBroken(!1)),t=n),++t>this.nbase&&(t=0)}while(t!=e);return r},N.prototype.find_central_loop=function(){var e=new A.a,t=null,n=null,r=null;for(function(){var e=new A.a,t=null,n=null;for(t=0;t<this.loop_count;t++){for(e=this.loops[t],n=0;n<this.loop_count;n++)this.loops[n].setMark(!1);e.setDepth(E(e))}}.bind(this)(),t=0,n=-1,r=0;r<this.loop_count;r++)(e=this.loops[r]).getNconnection()>t?(n=e.getDepth(),t=e.getNconnection(),this.root=e):e.getDepth()>n&&e.getNconnection()==t&&(n=e.getDepth(),this.root=e)},N.prototype.traverse_loop=function(e,t){var n,r,o,i,s,a,l,u,c,d,h,f,p,g,y,m,v,b,k,x,w,A,N,E,_,L,P,T,S,M,R,C,B,I,O,Y,U,X,D,q,F,z,V,j,G,H,J,W,K,Z,Q,$,ee,te,ne,re,oe,ie,se,ae,le,ue,ce,de,he,fe,pe,ge,ye,me=0;a=2*Math.PI/(this.nbase+1),b=null,M=-1;var ve=0;for(N=0;null!=(m=e.getConnection(ve));ve++,N++)n=-Math.sin(a*m.getStart()),r=Math.cos(a*m.getStart()),o=-Math.sin(a*m.getEnd()),i=Math.cos(a*m.getEnd())-r,s=n-o,l=Math.sqrt(i*i+s*s),m.setXrad(i/l),m.setYrad(s/l),m.setAngle(Math.atan2(s,i)),m.getAngle()<0&&m.setAngle(m.getAngle()+2*Math.PI),null!=t&&t.getRegion()==m.getRegion()&&(b=m,M=N);e:for(;;){this.determine_radius(e,this.lencut),u=e.getRadius()/this.RADIUS_REDUCTION_FACTOR,null==t?c=d=0:(h=(this.bases[b.getStart()].getX()+this.bases[b.getEnd()].getX())/2,f=(this.bases[b.getStart()].getY()+this.bases[b.getEnd()].getY())/2,c=h-u*b.getXrad(),d=f-u*b.getYrad()),P=-1==M?0:M,m=e.getConnection(P),L=0,R=!1;do{if((w=P-1)<0&&(w=e.getNconnection()-1),k=e.getConnection(w),this.connected_connection(k,m)?(P=w,m=k):R=!0,++L>e.getNconnection()){for(_=-1,N=0;N<e.getNconnection();N++)(w=N+1)>=e.getNconnection()&&(w=0),m=e.getConnection(N),(he=(v=e.getConnection(w)).getAngle()-m.getAngle())<0&&(he+=2*Math.PI),he>_&&(_=he,me=N);T=me,(P=me+1)>=e.getNconnection()&&(P=0),(m=e.getConnection(T)).setBroken(!0),R=!0}}while(!R);for(C=!1,H=P;!C;){for(L=0,R=!1,T=P,B=!1;!R;)if(m=e.getConnection(T),T==M&&(B=!0),(w=T+1)>=e.getNconnection()&&(w=0),v=e.getConnection(w),this.connected_connection(m,v)){if(++L>=e.getNconnection())break;T=w}else R=!0;for(N=J=W=S=this.find_ic_middle(P,T,t,b,e),R=!1,Z=0;!R;)(N=Z<0?J:0==Z?S:W)>=0&&(m=e.getConnection(N),null!=t&&b==m||(0==Z?(p=m.getAngle()-Math.asin(.5/u),g=m.getAngle()+Math.asin(.5/u),this.bases[m.getStart()].setX(c+u*Math.cos(p)),this.bases[m.getStart()].setY(d+u*Math.sin(p)),this.bases[m.getEnd()].setX(c+u*Math.cos(g)),this.bases[m.getEnd()].setY(d+u*Math.sin(g))):Z<0?((w=N+1)>=e.getNconnection()&&(w=0),m=e.getConnection(N),v=e.getConnection(w),ne=m.getXrad(),re=m.getYrad(),he=(m.getAngle()+v.getAngle())/2,m.getAngle()>v.getAngle()&&(he-=Math.PI),se=Math.cos(he),ue=Math.sin(he),ce=-se,(E=v.getAngle()-m.getAngle())<0&&(E+=2*Math.PI),de=m.isExtruded()?E<=Math.PI/2?2:1.5:1,this.bases[m.getEnd()].setX(this.bases[v.getStart()].getX()+de*ue),this.bases[m.getEnd()].setY(this.bases[v.getStart()].getY()+de*ce),this.bases[m.getStart()].setX(this.bases[m.getEnd()].getX()+re),this.bases[m.getStart()].setY(this.bases[m.getEnd()].getY()-ne)):((w=N-1)<0&&(w=e.getNconnection()-1),m=e.getConnection(w),oe=(v=e.getConnection(N)).getXrad(),ie=v.getYrad(),he=(m.getAngle()+v.getAngle())/2,m.getAngle()>v.getAngle()&&(he-=Math.PI),se=Math.cos(he),ue=-Math.sin(he),ce=se,(E=v.getAngle()-m.getAngle())<0&&(E+=2*Math.PI),de=m.isExtruded()?E<=Math.PI/2?2:1.5:1,this.bases[v.getStart()].setX(this.bases[m.getEnd()].getX()+de*ue),this.bases[v.getStart()].setY(this.bases[m.getEnd()].getY()+de*ce),this.bases[v.getEnd()].setX(this.bases[v.getStart()].getX()-ie),this.bases[v.getEnd()].setY(this.bases[v.getStart()].getY()+oe)))),Z<0?(W==T?W=-1:W>=0&&++W>=e.getNconnection()&&(W=0),Z=1):(J==P?J=-1:J>=0&&--J<0&&(J=e.getNconnection()-1),Z=-1),R=-1==J&&-1==W;if((K=T+1)>=e.getNconnection()&&(K=0),T!=P&&(P!=H||K!=H))if(m=e.getConnection(P),v=e.getConnection(T),$=this.bases[v.getEnd()].getX()-this.bases[m.getStart()].getX(),ee=this.bases[v.getEnd()].getY()-this.bases[m.getStart()].getY(),O=this.bases[m.getStart()].getX()+$/2,Y=this.bases[m.getStart()].getY()+ee/2,D=$/(te=Math.sqrt($*$+ee*ee)),q=ee/te,F=c-O,z=d-Y,U=(V=(F/=te=Math.sqrt($*$+ee*ee))*D+(z/=te)*q)*D-F,X=V*q-z,U/=te=Math.sqrt(U*U+X*X),X/=te,$=this.bases[m.getStart()].getX()-c,ee=this.bases[m.getStart()].getY()-d,(he=Math.atan2(ee,$))<0&&(he+=2*Math.PI),$=this.bases[v.getEnd()].getX()-c,ee=this.bases[v.getEnd()].getY()-d,(fe=Math.atan2(ee,$))<0&&(fe+=2*Math.PI),fe<he&&(fe+=2*Math.PI),j=c+(I=fe-he>Math.PI?-1:1)*u*U,G=d+I*u*X,B)c-=j-O,d-=G-Y;else for(N=P;x=(m=e.getConnection(N)).getStart(),this.bases[x].setX(this.bases[x].getX()+j-O),this.bases[x].setY(this.bases[x].getY()+G-Y),x=m.getEnd(),this.bases[x].setX(this.bases[x].getX()+j-O),this.bases[x].setY(this.bases[x].getY()+G-Y),N!=T;)++N>=e.getNconnection()&&(N=0);C=(P=K)==H}for(N=0;N<e.getNconnection();N++){if(m=e.getConnection(N),(w=N+1)>=e.getNconnection()&&(w=0),v=e.getConnection(w),$=this.bases[m.getEnd()].getX()-c,ee=this.bases[m.getEnd()].getY()-d,le=Math.sqrt($*$+ee*ee),(he=Math.atan2(ee,$))<0&&(he+=2*Math.PI),$=this.bases[v.getStart()].getX()-c,ee=this.bases[v.getStart()].getY()-d,ae=Math.sqrt($*$+ee*ee),(fe=Math.atan2(ee,$))<0&&(fe+=2*Math.PI),fe<he&&(fe+=2*Math.PI),Q=fe-he,(ye=v.getAngle()-m.getAngle())<=0&&(ye+=2*Math.PI),Math.abs(Q-ye)>Math.PI)if(m.isExtruded())console.log("Warning from traverse_loop. Loop "+e.getNumber()+" has crossed regions\n");else if(v.getStart()-m.getEnd()!=1){m.setExtruded(!0);continue e}if(m.isExtruded())this.construct_extruded_segment(m,v);else for((A=v.getStart()-m.getEnd())<0&&(A+=this.nbase+1),a=Q/A,w=1;w<A;w++)(x=m.getEnd()+w)>this.nbase&&(x-=this.nbase+1),te=le+(ae-le)*((y=he+w*a)-he)/Q,this.bases[x].setX(c+te*Math.cos(y)),this.bases[x].setY(d+te*Math.sin(y))}break}for(N=0;N<e.getNconnection();N++)M!=N&&(m=e.getConnection(N),this.generate_region(m),this.traverse_loop(m.getLoop(),m));for(A=0,pe=0,ge=0,N=0;N<e.getNconnection();N++)if((w=N+1)>=e.getNconnection()&&(w=0),m=e.getConnection(N),v=e.getConnection(w),A+=2,pe+=this.bases[m.getStart()].getX()+this.bases[m.getEnd()].getX(),ge+=this.bases[m.getStart()].getY()+this.bases[m.getEnd()].getY(),!m.isExtruded())for(w=m.getEnd()+1;w!=v.getStart();w++)w>this.nbase&&(w-=this.nbase+1),A++,pe+=this.bases[w].getX(),ge+=this.bases[w].getY();e.setX(pe/A),e.setY(ge/A)},N.prototype.determine_radius=function(e,t){var n,r,o,i,s,a,l,u,c,d,h,f=0,p=new k.Connection,g=new k.Connection;do{for(n=1e10,s=0,i=0,u=0;u<e.getNconnection();u++)p=e.getConnection(u),(c=u+1)>=e.getNconnection()&&(c=0),g=e.getConnection(c),d=p.getEnd(),(h=g.getStart())<d&&(h+=this.nbase+1),(o=g.getAngle()-p.getAngle())<=0&&(o+=2*Math.PI),i+=o*(1/(r=p.isExtruded()?o<=Math.PI/2?2:1.5:h-d)+1),s+=o*o/r,(l=o/r)<n&&!p.isExtruded()&&r>1&&(n=l,f=u);(a=i/s)<.7071068&&(a=.7071068),n*a<t&&e.getConnection(f).setExtruded(!0)}while(n*a<t);e.getRadius()>0?a=e.getRadius():e.setRadius(a)},N.prototype.find_ic_middle=function(e,t,n,r,o){var i,s,a,l,u;for(i=0,s=-1,a=e,u=!1;!u;)i++>2*o.getNconnection()&&console.log("Infinite loop in 'find_ic_middle'"),null!=n&&o.getConnection(a)==r&&(s=a),u=a==t,++a>=o.getNconnection()&&(a=0);if(-1==s){for(l=1,a=e;l<(i+1)/2;l++)++a>=o.getNconnection()&&(a=0);s=a}return s},N.prototype.construct_extruded_segment=function(e,t){var n,r,o,i,s,a,l,u,c,d,h,f,p,g,y,m,v,b;if(n=e.getAngle(),(o=r=t.getAngle())<n&&(o+=2*Math.PI),i=(n+o)/2,p=e.getEnd(),(y=(g=t.getStart())-p)<0&&(y+=this.nbase+1),(h=t.getAngle()-e.getAngle())<0&&(h+=2*Math.PI),2==y)this.construct_circle_segment(p,g);else{s=this.bases[g].getX()-this.bases[p].getX(),a=this.bases[g].getY()-this.bases[p].getY(),s/=d=Math.sqrt(s*s+a*a),a/=d,d>=1.5&&h<=Math.PI/2&&((m=p+1)>this.nbase&&(m-=this.nbase+1),(v=g-1)<0&&(v+=this.nbase+1),this.bases[m].setX(this.bases[p].getX()+.5*s),this.bases[m].setY(this.bases[p].getY()+.5*a),this.bases[v].setX(this.bases[g].getX()-.5*s),this.bases[v].setY(this.bases[g].getY()-.5*a),p=m,g=v);do{b=!1,this.construct_circle_segment(p,g),(m=p+1)>this.nbase&&(m-=this.nbase+1),s=this.bases[m].getX()-this.bases[p].getX(),a=this.bases[m].getY()-this.bases[p].getY(),(l=Math.atan2(a,s))<0&&(l+=2*Math.PI),(f=l-n)<0&&(f+=2*Math.PI),f>Math.PI&&(b=!0),(v=g-1)<0&&(v+=this.nbase+1),s=this.bases[v].getX()-this.bases[g].getX(),a=this.bases[v].getY()-this.bases[g].getY(),(u=Math.atan2(a,s))<0&&(u+=2*Math.PI),(f=r-u)<0&&(f+=2*Math.PI),f>Math.PI&&(b=!0),b&&(c=this.minf2(i,n+.5),this.bases[m].setX(this.bases[p].getX()+Math.cos(c)),this.bases[m].setY(this.bases[p].getY()+Math.sin(c)),p=m,c=this.maxf2(i,o-.5),this.bases[v].setX(this.bases[g].getX()+Math.cos(c)),this.bases[v].setY(this.bases[g].getY()+Math.sin(c)),g=v,y-=2)}while(b&&y>1)}},N.prototype.construct_circle_segment=function(e,t){var n,r,o,i,s,a,l,u,c,d,h,f,p,g,y;if(n=this.bases[t].getX()-this.bases[e].getX(),r=this.bases[t].getY()-this.bases[e].getY(),o=Math.sqrt(n*n+r*r),(p=t-e)<0&&(p+=this.nbase+1),o>=p)for(n/=o,r/=o,g=1;g<p;g++)(y=e+g)>this.nbase&&(y-=this.nbase+1),this.bases[y].setX(this.bases[e].getX()+n*g/p),this.bases[y].setY(this.bases[e].getY()+r*g/p);else for(this.find_center_for_arc(p-1,o),n/=o,r/=o,i=this.bases[e].getX()+n*o/2,s=this.bases[e].getY()+r*o/2,a=r,l=-n,u=i+this._h*a,c=s+this._h*l,d=this.bases[e].getX()-u,h=this.bases[e].getY()-c,o=Math.sqrt(d*d+h*h),f=Math.atan2(h,d),g=1;g<p;g++)(y=e+g)>this.nbase&&(y-=this.nbase+1),this.bases[y].setX(u+o*Math.cos(f+g*this.angleinc)),this.bases[y].setY(c+o*Math.sin(f+g*this.angleinc))},N.prototype.find_center_for_arc=function(e,t){var n,r,o,i,s,a,l,u;o=-(r=(e+1)/Math.PI)-t/(e+1.000001-t),t<1&&(o=0),u=0;do{n=(r+o)/2,s=1-.5/((i=Math.sqrt(n*n+t*t/4))*i),Math.abs(s)>1&&console.log("Unexpected large magnitude discriminant = "+s+" "+i),(l=(a=Math.acos(s))*(e+1)+2*Math.acos(n/i)-2*Math.PI)>0?o=n:r=n}while(Math.abs(l)>1e-4&&++u<this.MAXITER);u>=this.MAXITER&&(noIterationFailureYet&&(console.log("Iteration failed in find_center_for_arc"),noIterationFailureYet=!1),n=0,a=0),this._h=n,this.angleinc=a},N.prototype.generate_region=function(e){var t,n,r,o,i,s;for(s=e.getRegion(),t=0,e.getStart()==s.getStart1()?(n=s.getStart1(),r=s.getEnd1()):(n=s.getStart2(),r=s.getEnd2()),(this.bases[e.getStart()].getX()>this.ANUM-100||this.bases[e.getEnd()].getX()>this.ANUM-100)&&console.log("Bad region passed to generate_region. Coordinates not defined."),o=n+1;o<=r;o++)t++,this.bases[o].setX(this.bases[e.getStart()].getX()+this.HELIX_FACTOR*t*e.getXrad()),this.bases[o].setY(this.bases[e.getStart()].getY()+this.HELIX_FACTOR*t*e.getYrad()),i=this.bases[o].getMate(),this.bases[i].setX(this.bases[e.getEnd()].getX()+this.HELIX_FACTOR*t*e.getXrad()),this.bases[i].setY(this.bases[e.getEnd()].getY()+this.HELIX_FACTOR*t*e.getYrad())},N.prototype.minf2=function(e,t){return e<t?e:t},N.prototype.maxf2=function(e,t){return e>t?e:t},N.prototype.connected_connection=function(e,t){return!!e.isExtruded()||e.getEnd()+1==t.getStart()},n.d(t,"FornaContainer",function(){return _}),n.d(t,"rnaPlot",function(){return L}),n.d(t,"rnaTreemap",function(){return P})}])});
//# sourceMappingURL=fornac.js.map